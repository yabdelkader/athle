-- complément de Update.java et administration.html
select * from ligne order by naissance desc;

UPDATE ligne SET naissance = 1993 WHERE nom like 'anselme' and prenom = 'jeanne' and naissance = 2030;

UPDATE ligne SET prenom = REPLACE (prenom, '-', ' ') WHERE prenom LIKE '%-%';



CREATE TABLE IF NOT EXISTS personne (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `nom` varchar(30) NOT NULL,
  `prenom` varchar(20) NOT NULL,
  `sexe` int(1) NOT NULL DEFAULT '0',
  `naissance` int(11) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1;


INSERT INTO personne (nom, prenom, naissance)
select nom, prenom, naissance from ligne  
where naissance > 1950 and naissance < 2000
group by nom, prenom, naissance 
order by nom, prenom, naissance;
-- 20 826 lignes





SELECT DISTINCT l1.nom, l1.prenom, l1.naissance, l2.naissance FROM ligne l1, ligne l2
WHERE l1.nom = l2.nom and l1.prenom = l2.prenom and l1.naissance != l2.naissance;

UPDATE ligne l SET l.naissance = (SELECT p.naissance  FROM personne p WHERE p.nom = l.nom AND p.prenom = l.prenom LIMIT 1)
WHERE l.naissance < 1950;

UPDATE ligne l SET l.naissance = (SELECT p.naissance  FROM personne p WHERE p.nom = l.nom AND p.prenom = l.prenom LIMIT 1)
WHERE l.naissance > 2000;






-- insertion des athletes, done
-- insertion des clubs, done
-- insertion des licences
INSERT INTO licence (idPersonne, idClub, annee)
SELECT p.id, (SELECT c.id FROM club c WHERE c.nom = l.club), l.annee
FROM personne p 
INNER JOIN ligne l ON p.nom = l.nom AND p.prenom = l.prenom 

-- select * from licence l1, licence l2 where l1.id != l2

ALTER table licence ADD UNIQUE (idPersonne, idClub, annee);

-- détection doublon
SELECT   COUNT(*) AS nbr_doublon, champ1, champ2, champ3
FROM     table
GROUP BY champ1, champ2, champ3
HAVING   COUNT(*) > 1;

DELETE t1 
FROM licence AS t1, licence AS t2
WHERE t1.id > t2.id
AND t1.idPersonne = t2.idPersonne
AND t1.idClub = t2.idClub
AND t1.annee = t2.annee

SELECT distinct t2.id
FROM licence AS t1, licence AS t2
WHERE t1.annee =2014
AND t2.annee =2014
AND t1.id > t2.id
AND t1.idPersonne = t2.idPersonne
AND t1.idClub = t2.idClub



DELETE from licence where id in (36621,36683,36688,36743,36750,36806,36813,37048,37054,37069,37112,37121,37170,37178,37266,37291,37303,37308,37576,37577,37603,37621,37683,37706,37730,37733,37791,37843,37868,37875,37954,38000,38035,38100,38161,38183,38191,38207,38237,38267,38300,38344,38347,38351,38375,38391,38428,38430,38501,38551,38579,38613,38634,38691,38699,38737,38744,38754,38804,38807,38851,38872,38880,38943,38960,39002,39031,39037,39043,39079,39101,39136,39219,39223,39259,39268,39278,39316,39319,39379,39532,39536,39585,39589,39593,39600,39627,39650,39677,39701,39760,39803,39811,39813,39856,39866,39867,39888,39932,39937,39977,40115,40182,40198,40204,40213,40271,40280,40297,40382,40430,40453,40481,40502,40505,40515,40546,40552,40634,40655,40657,40663,40667,40774,40785,40808,40818,40840,40894,40898,40913,40987,41014,41015,41127,41129,41169,41183,41242,41261,41302,41317,41377,41440,41458,41468,41470,41488,41622,41636,41662,41684,41705,41711,41726,41732,41762,41768,41786,41791,41875,41900,41904,41913,41941,41969,41975,42027,42092,42111,42139,42194,42205,42231,42238,42289,42330,42440,42454,42476,42529,42559,42607,42613,42645,42652,42672,42693,42704,42710,42717,42727,42738,42744,42751,42823,42871,42882,42949,43083,43086,43090,43100,43290,43292,43424,43427,43491,43540,43635,43640,43646,43675,43711,43780,43783,43803,43808,43812,43872,43973,44022,44052,44063,44084,44104,44114,44116,44117,44215,44275,44299,44412,44419,44444,44508,44531,44716,44732,44735,44768,44796,44800,44850,44877,44890,44895,45052,45056,45159,45192,45194,45221,45275,45291,45416,45420,45422,45458,45501,45519,45574,45609,45646,45677,45692,45695,45828,45913,45923,45950,45952,45979,46008,46058,46063,46067,46112,46115,46127,46137,46138,46164,46237,46358,46450,46453,46454,46459,46485,46500,46518,46519,46524,46547,46553,46559,46565,46605,46692,46697,46705,46734,46794,46872,46895,46902,47030,47058,47063,47073,47160,47163,47186,47194,47278,47288,47309,47313,47328,47351,47385,47392,47423,47463,47498,47502,47548,47608,47631,47632,47666,47687,47763,47787,47809,47843,47860,47952,47976,47986,48067,48081,48129,48138,48148,48163,48172,48182,48197,48204,48260,48305,48311,48405,48412,48454,48468,48512,48575,48582,48703,48736,48741,48774,48784,48812,48941,48950,48979,48988,49070,49075,49083,49097,49156,49221,49225,49473,49482,49601,49605,49655,49724,49736,49741,49810,49916,50142,50144,50186,50193,50405,50411,50432,50473,50484,50616,50623,50636,50717,50767,50769,50797,50813,50829,50875,50881,50930,50950,50957,50966,51070,51103,51293,51295,51299,51303,51305,51309,51334,51344,51351,51390,51414,51483,51488,51492,51499,51502,51507,51545,51598,51612,51644,51683,51733,51787,51807,51850,51872,51879,51886,51902,51927,51986,51995,52018,52049,52051,52077,52081,52084,52108,52111,52148,52186,52187,52193,52221,52244,52259,52268,52292,52294,52311,52319,52329,52337,52349,52351,52358,52412,52413,52434,52616,52624,52638,52660,52686,52690,52719,52731,52801,52819,52832,52874,52879,52898,52906,52909,52912,52987,53014,53023,53028,53031,53072,53075,53078,53121,53140,53160,53179,53442,53549,53555,53558,53559,53569,53602,53618,53621,53633,53638,53651,53652,53798,53803,53817,53825,53844,53871,53882,53900,53911,53953,53956,53960,53964,53994,54104,54124,54148,54158,54189,54197,54298,54421,54434,54467,54491,54514,54738,54784,54871,54876,54940,54973,55023,55026,55031,55085,55159,55164,55200,55228,55315,55325,55417,55430,55433,55597,55708,55710,55720,55792,55800,55808,55816,55845,55858,55861,56071,56072,56076,56105,56229,56240,56282,56296,56309,56312,56342,56355,56368,56379,56410,56435,56443,56448,56456,56461,56471,56482,56483,56488,56491,56494,56604,56610,56633,56645,56650,56671,56693,56708,56716,56720,56735,56743,56747,56761,56774,56810,56815,56821,56826,56897,56917,56931,56934,56939,56945,57029,57038,57047,57061,57089,57113,57134,57142,57159,57162,57219,57220,57224,57237,57253,57276,57327,57346,57349,57359,57375,57439,57444,57485,57550,57569,57598,57629,57632,57688,57691,57759,57775,57784,57833,57917,57924,57968,57981,58018,58046,58098,58109,58137,58144,58180,58187,58194,58294,58298,58313,58315,58318,58323,58498,58556,58582,58600,58650,58669,58676,58757,58863,58889,58904,58922,59008,59214,59270,59367,59370,59431,59433,59448,59451,59453,59476,59477,59520,59533,59589,59623,59667,59774,59870,59877,59893,59900,59929,59957,60008,60018,60141,60150,60184,60188,60232,60252,60257,60264,60318,60319,60325,60411,60414,60494,60509,60516,60555,60559,60568,60579,60693,60708,60742,60785,60916,60920,60937,61015,61024,61043,61075,61082,61173,61178,61270,61280,61354,61359,61538,61649,61681,61756,61765,61779,61780,61851,61858,61869,61950,61968,62005,62007,62051,62086,62131,62241,62260,62353,62356,62434,62446,62452,62459,62501,62509,62574,62580,62602,62608,62679,62690,62704,62748,62749,62789,62802,62835,62850,62852,62875,62878,62883,62893,62898,62908,63041,63052,63085,63086,63090,63091,63192,63195,63231,63234,63271,63281,63289,63308,63311,63360,63375,63476,63478,63506,63524,63594,63612,63630,63755,63782,63890,63901,63902,63945,64026,64078,64110,64156,64205,64220,64268,64361,64364,64411,64474,64557,64573,64613,64635,64637,64641,64708,64713,64748,64754,64759,64783,64857,64895,65005,65035,65048,65114,65273,65282,65352,65354,65378,65385,65445,65464,65489,65497,65514,65541,65575,65673,65693,65791,65794,65796,65834,65937,66125,66133,66142,66153,66159,66209,66214,66215,66221,66226,66227,66402,66403,66412,66469,66585,66616,66692,66707,66723,66730,66745,66751,66780,66797,66798,66810,66841,66844,66860,66872,66888,66901,66918,67001,67014,67080,67084,67101,67112,67118,67179,67196,67198,67244,67251,67303,67307,67357,67539,67581,67587,67601,67615,67616,67627,67692,67715,67764,67817,67841,67845,67850,67906,68114,68119,68122,68130,68268,68288,68382,68400,68418,68459,68463,68472,68484,68488,68497,68529,68535,68540,68564,68594,68598,68613,68744,68748,68763,68776,68811,68816,68825,68829,68861,68876,68889,69034,69090,69097,69134,69154,69173,69179,69298,69316,69334,69350,69360,69389,69394,69435,69437,69469,69597,69639,69661,69690,69830,69842,69845,69872,69881,69962,69967,69977,69978,69984,70008,70081,70085,70095,70116,70130,70230,70231,70234,70317,70324,70343,70364,70387,70436,70450,70470,70508,70615,70717,70723,70726,70729,70864,71015,71053,71072,71082,71101,71130,71174,71223,71297,71310,71428,71442,71519,71525,71539,71555,71617,71655,71658,71765,71838,71843,71847,71851,71860,71882,71886,71919,71958,71959,71972,71973,71986,71987,71996,72015,72052,72054,72059,72130,72137,72139,72143,72162,72166,72177,72260,72274,72334,72346,72375,72389,72472,72501,72526,72530,72552,72556,72574,72585,72655,72661,72665,72719,72723,72770,72814,72830,72892,72997,72999,73005,73095,73098,73106,73184,73187,73219,73245,73252,73272,73287,73291,73312,73321,73328,73361,73414,73418,73434,73439,73444,73448,73453,73458,73518,73527,73561,73568,73594,73687,73694,73739,73763,73768,73774,73780,73781,73910,73928,73946,73953,74115,74206,74208,74224,74253,74519,74524,74566,74594,74602,74648,74654,74658,74677,74702,74705,74709,74741,74755,74799,74801,74881,74901,74915,75004,75050,75056,75062,75079,75343,75349,75358,75465,75483,75547,75552,75561,75613,75646,75739,75740,75842,75848,75966,75991,76032,76037,76070,76086,76112,76167,76175,76285,76332,76382,76398,76428,76430,76487,76503,76531,76669,76670,76697,76699,76736,76765,76789,76810,76844,76925,76942,76951,77001,77016,77027,77042,77061,77072,77123,77138,77184,77197,77208,77322,77329,77339,77344,77350,77363,77368,77374,77403,77409,77428,77445,77496,77502,77522,77529,77532,77596,77604,77695,77698,77703,77708,77711,77716,77726,77733,77796,77817,77841,77901,77916,77940,77950,78025,78027,78030,78032,78073,78127,78241,78250,78345,78401,78411,78476,78503,78504,78527,78536,78568,78571,78632,78684,78696,78775,78780,78845,78846,78908,78947,78956,79022,79141,79149,79176,79190,79229,79233,79274,79278,79282,79294,79306,79347,79377,79382,79420,79459,79482,79510,79556,79608,79622,79627,79728,79739,79826,79828,79905,79939,80001,80050,80054,80084,80086,80134,80138,80167,80175,80179,80212,80227,80250,80309,80320,80338,80363,80427,80444,80462,80465,80481,80517,80527,80561,80576,80605,80636,80641,80670,80711,80774,80813,80827,80830,80833,80848,80865,80907,80918,80934,80936,80940,80990,81043,81044,81049,81059,81060,81065,81080,81263,81299,81329,81411,81428,81446,81456,81524,81585,81617,81660,81664,81770,81812,81819,81832,81863,81867,81921,81977,82032,82065,82067,82079,82107,82118,82165,82221,82327,82333,82335,82337,82344,82362,82365,82374,82377,82418,82453,82455,82470,82629,82686,82694,82696,82706,82717,82725,82810,82817,82885,82890,83025,83125,83128,83164,83255,83268,83276,83289,83297,83336,83392,83412,83492,83498,83588,83601,83607,83625,83652,83679,83696,83698,83741,83781,83825,83827,83863,83879,83891,84045,84075,84077,84097,84102,84116,84156,84223,84239,84284,84306,84422,84605,84622,84631,84763,84804,84808,84834,84837,84846,84990,84997,85005,85107,85122,85127,85129,85168,85184,85186,85225,85277,85282,85288,85304,85311,85315,85321,85347,85351,85357,85398,85429,85467,85486,85488,85521,85759,85820,85823,85945,85952,85980,86051,86063,86071,86096,86123,86432,86437,86450,86458,86492,86519,86531,86566,86579,86624,86637,86641,86649,86670,86682,86713,86785,86839,86882,86937,86942,86992,87055,87058,87091,87190,87233,87294,87297,87301,87304,87335,87366,87370,87376,87402,87403,87409,87417,87420,87429,87436,87455,87459,87532,87533,87535,87539,87542,87543,87545,87549,87632,87651,87655,87666,87764,87893,87987,88004,88021,88046,88048,88051,88056,88184,88187,88199,88244,88264,88285,88322,88325,88423,88429,88449,88529,88544,88621,88641,88666,88704,88740,88746,88816,88853,88856,88955,88973,89037,89125,89142,89177,89232,89238,89270,89334,89358,89363,89411,89419,89435,89450,89514,89532,89616,89621,89659,89741,89766,89784,89800,89861,89893,89895,89928,89934,89938,90042,90100,90153,90260,90269,90318,90335,90358,90373,90381,90388,90465,90469,90561,90565,90574,90595,90596,90612,90651,90653,90742,90749,90852,90966,91028,91030,91117,91143,91155,91247,91260,91270,91286,91288,91291,91316,91339,91348,91352,91381,91405,91486,91491,91574,91593,91615,91636,91679,91686,91691,91704,91710,91739,91806,91883,91898,91967,92028,92051,92081,92092,92152,92178,92184,92232,92315,92317,92342,92361,92382,92466,92476,92489,92492,92495,92591,92664,92666,92685,92724,92746,92749,92752,92769,92775,92783,92796,92802,92810,92827,92852,92860,92874,93067,93073,93088,93090,93168,93170,93172,93195,93293,93313,93452,93591,93596,93641,93645,93668,93674,93675,93678,93688,93694,93695,93698,93712,93750,93881,93884,93890,93896,93903,93933,93949,94006,94010,94019,94026,94044,94102,94116,94131,94163,94168,94177,94183,94206,94223,94245,94295,94415,94420,94609,94611,94659,94676,94681,94685,94790,94846,94862,94881,94897,94916,94932,94940,94956,94966,95004,95065,95101,95113,95145,95166,95170,95216,95295,95387,95390,95393,95431,95433,95459,95496,95501,95528,95561,95570,95578,95603,95628,95680,95726,95762,95803,95805,95865,95869,95882,95889,95936,96033,96073,96206,96240,96246,96280,96284,96304,96336,96346,96400,96445,96526,96530,96534,96552,96566,96640,96649,96715,96716,96726,96753,96775,96809,96826,96948,96960,96979,96982,97079,97084,97162,97170,97172,97196,97257,97282,97334,97339,97401,97468,97659,97674,97781,97820,97828,97839,97852,97887,97898,97927,98041,98059,98070,98074,98094,98098,98210,98216,98224,98230,98239,98241,98307,98335,98340,98358,98360,98361,98457,98495,98537,98606,98610,98619,98623,98687,98688,98708,98730,98738,98741,98772,98777,98785,98820,98852,98856,98860,99010,99012,99019,99065,99067,99077,99081,99085,99126,99175,99202,99216,99225,99236,99255,99395,99405,99432,99531,99534,99575,99614

)


INSERT INTO `ligne` (`rang`, `perf`, `nom`, `prenom`, `sexe`, `club`, `ligue`, `datePerf`, `naissance`, `ville`, `idEpreuve`, `annee`)
VALUES (1600,'1.58.12','ABDELKADER','Yann',0,'NEUILLY-PLAISANCE SPORTS','','18/06/2002',1977,'Nogent sur marn',800,2002);
