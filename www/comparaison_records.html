<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="css/bootstrap.min.css" media="screen, projection" rel="stylesheet" type="text/css" />
<link href="css/dataTables.bootstrap.min.css" media="screen, projection" rel="stylesheet" type="text/css" />

<script src="js/jquery-1.12.3.js" type="text/javascript"></script>
<script src="js/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="js/dataTables.bootstrap.min.js"></script>
<script src="js/bootstrap.min.js" type="text/javascript"></script>
</head>

<body>
	<div class="content">

		<div class="col-sm-2"></div>
		<div class="col-sm-8">

			<div id="menu"></div>
			<h1>Ecarts de records en pourcentage</h1>

<div class="row">

	<!-- div selection1 -->
	<div class="form-group col-sm-5">
	
	<label>Records de la 1ère sélection</label>
	<select id="selectZone1" class="form-control">
		<option value="1" selected="selected">Monde</option>
		<option value="2">Europe</option>
		<option value="3">France</option>
		<option value="4">Club</option>
		<option value="5">Athlète</option>

	</select>
	<select id="selectSexe1" class="form-control">
		<option>Femme</option>
		<option selected="selected">Homme</option>
	</select>	
	<select id="selectCategorie1" class="form-control">
		<option>Toutes catégories</option>
		<option>Cadet</option>
		<option>Junior</option>
		<option selected="selected">35</option>
		<option>40</option>
		<option>45</option>
		<option>50</option>
		<option>55</option>
		<option>60</option>
		<option>65</option>
		<option>70</option>
		<option>75</option>
		<option>80</option>
	</select>

	<div id="divClub1" style="display:none">
		<label for="club1" class="col-sm-3 control-label">Club</label>
		<div class="col-sm-5">
		 	<input type="text" name="searchClub1" id="searchClub1" placeholder="saisissez le début du nom" list="listeClub1"
		 	 autocomplete="off" style="width: 250px;"/>
			<datalist id="listeClub1"></datalist>	
		</div>
	</div>
			 
	<br/><br/>

	<div id="divAthlete1" style="display:none">
		<label for="nom1" class="col-sm-2 control-label">Nom</label>
		<div class="col-sm-5">
			<input type="text" class="alphaonly form-control" name="nom1" placeholder="nom" onkeyup="showHint(this.value, 'txtHint1')"								
		 size="20" maxlength="20" />
		</div>
		<div class="col-sm-5"><span id="txtHint1"></span></div>		
		
		<br/><br/>

		<label for="prenom1" class="col-sm-2 control-label">Prénom</label>
		
		<div class="col-sm-5">
			<input type="search" class="alphaonly form-control" name="prenom1" placeholder="prénom" size="20" maxlength="20" >
		</div>
		<div class="col-sm-5"><span id="txtHint1Prenom"></span></div>
		<div class="col-sm-1"><button class="btn btn-primary btn-sm" onclick="chargeAthlete1();">OK</button></div>
	</div>
	</div> <!-- end selection 1 -->

	<!-- selection 2 -->
	<div class="form-group col-sm-5">
	<label>Records de la 2nde sélection</label>
	<select id="selectZone2" class="form-control">
		<option selected="selected" value="1">Monde</option>
		<option value="2">Europe</option>
		<option value="3">France</option>
		<option value="4">Club</option>
		<option value="5">Athlète</option>
	</select>
	<select id="selectSexe2" class="form-control">
		<option selected="selected">Femme</option>
		<option>Homme</option>
	</select>	
	<select id="selectCategorie2" class="form-control">
		<option selected="selected">Toutes catégories</option>
		<option>Cadet</option>
		<option>Junior</option>
		<option>40</option>
		<option>45</option>
		<option>50</option>
		<option>55</option>
		<option>60</option>
		<option>65</option>
		<option>70</option>
		<option>75</option>
		<option>80</option>

	</select>

	<div id="divClub2" style="display:none">
		<label for="club2" class="col-sm-3 control-label">Club</label>
		<div class="col-sm-5">
		 	<input type="text" name="searchClub2" id="searchClub2" placeholder="saisissez le début du nom" list="listeClub2"
		 	 autocomplete="off" style="width: 250px;"/>
			<datalist id="listeClub2"></datalist>	
		</div>
	</div>
			 
			 <br/><br/>

	<div id="divAthlete2"> <!--  style="display:none"> -->
		 	 		
		<label for="textNom2" class="col-sm-2 control-label">Nom</label>
		<div class="col-sm-5">
			<input type="text" class="alphaonly form-control" id="textNom2" name="textNom2" placeholder="nom" onkeyup="showHint(this.value, 'txtHint2')"
		 size="20" maxlength="20" />
		</div>
		<div class="col-sm-5"><span id="txtHint2"></span></div>		
				
		<br/><br/>
	
		<label for="prenom2" class="col-sm-2 control-label">Prénom</label>
		<div class="col-sm-5">
			<input type="search" class="alphaonly form-control" name="prenom2" placeholder="prénom" size="20" maxlength="20" >
		</div>
		<div class="col-sm-5"><span id="txtHint2Prenom"></span></div> 		
		<div class="col-sm-1"><button class="btn btn-primary btn-sm" onclick="chargeAthlete2();">OK</button></div>
		</div> 
	</div>
<!--  </form>  -->
</div> <!-- END row -->
<br/>


	<table class="table table-striped table-bordered" id="table_ecarts"></table>

		</div>
	</div>

	<script src="js/menu.js" type="text/javascript"></script>
	
	


<script type="text/javascript">

function selection(){
	
    $("#table_ecarts tbody").children().remove();
    
    var zone1 = document.getElementById("selectZone1").selectedIndex;
	var zone2 = document.getElementById("selectZone2").selectedIndex;
	var categorie1 = document.getElementById("selectCategorie1").selectedIndex;
	var categorie2 = document.getElementById("selectCategorie2").selectedIndex;
	var sexe1 = document.getElementById("selectSexe1").selectedIndex;
	var sexe2 = document.getElementById("selectSexe2").selectedIndex;
	
	console.log(zone1 + ' ' + categorie1 + ' ' + sexe1 + ' ' + zone2 + ' ' + categorie2 + ' ' + sexe2);

	// Par défaut on masque les div "Club" et "Athlete"
	$("#divClub2").css({'display' : 'none'});	
	$("#divAthlete2").css({'display' : 'none'});
	$("#selectCategorie2").css({'display' : ''});
	$("#selectSexe2").css({'display' : ''});

	// ======= ZONE 1 =======
	// Si selection "Club" alors on montre input club et on laisse sexe - catégorie
	if(zone1 == 3){
		$("#divClub2").css({'display' : ''});	
	}
	// Si selection "Athlete" alors on montre inuput athle et on masque sexe - categorie
	else if(zone1 == 4){
		$("#divAthlete1").css({'display' : ''});
		$("#selectCategorie1").css({'display' : 'none'});
		$("#selectSexe1").css({'display' : 'none'});
	}
	// ======= ZONE 2 =======
	// Si selection "Club" alors on montre input club et on laisse sexe - catégorie
	if(zone2 == 3){
		$("#divClub2").css({'display' : ''});	
	}
	// Si selection "Athlete" alors on montre inuput athle et on masque sexe - categorie
	else if(zone2 == 4){
		$("#divAthlete2").css({'display' : ''});
		$("#selectCategorie2").css({'display' : 'none'});
		$("#selectSexe2").css({'display' : 'none'});
	}

    // ---- SELECTION 1 ----
	// zone monde 0
	// -------- categorie all
    if (zone1 == 0) {

	// ---- sexe femme  
	if (sexe1 == 0){
		if (categorie1 == 0){recordsSel1 = recordsMondeFemme;}
		else {recordsSel1 = recordsMondeFemmeJunior;} // TODO autres cat.
	}
		// ---- sexe homme 
	else {
		if (categorie1 == 0){	recordsSel1 = recordsMondeHomme;}
		else if (categorie1 == 1){	recordsSel1 = recordsMondeHommeCadet;}
		else if (categorie1 == 2){	recordsSel1 = recordsMondeHommeJunior;}
		else if (categorie1 == 3){	recordsSel1 = recordsMondeHomme35;}
		else if (categorie1 == 4){	recordsSel1 = recordsMondeHomme40;}
		else if (categorie1 == 5){	recordsSel1 = recordsMondeHomme45;}
		else if (categorie1 == 6){	recordsSel1 = recordsMondeHomme50;}
		else if (categorie1 == 7){	recordsSel1 = recordsMondeHomme55;}
		else if (categorie1 == 8){	recordsSel1 = recordsMondeHomme60;}
		else if (categorie1 == 9){	recordsSel1 = recordsMondeHomme65;}
		else if (categorie1 == 10){	recordsSel1 = recordsMondeHomme70;}
		else if (categorie1 == 11){	recordsSel1 = recordsMondeHomme75;}
		else if (categorie1 == 12){	recordsSel1 = recordsMondeHomme80;}
	}
	} // end monde
	// zone europe 1
	else if (zone1 == 1 && sexe1 == 1){recordsSel1 = recordsEuropeHommeJunior;}
	else if (zone1 == 1 && sexe1 == 0){recordsSel1 = recordsEuropeFemme;}
	
	// zone france 2
	else if (zone1 == 2 && categorie1 == 0 && sexe1 == 1){	recordsSel1 = recordsFranceHomme;}
	else if (zone1 == 2 && categorie1 == 0 && sexe1 == 0){	recordsSel1 = recordsFranceFemme;}
	else if (zone1 == 2 && categorie1 == 2 && sexe1 == 1){	recordsSel1 = recordsFranceHommeJunior;}
	else if (zone1 == 2 && categorie1 == 2 && sexe1 == 0){	recordsSel1 = recordsFranceFemmeJunior;}    
	// zone autre
	else {
		console.log('selection 1 : athlète');
		recordsSel1 = {'record' : []};
	}

    // ---- SELECTION 2 ----
    	// zone monde 0
	// -------- categorie all
	// zone monde 0
	// -------- categorie all
    if (zone2 == 0) {

	// ---- sexe femme  
	if (sexe2 == 0){
		if (categorie2 == 0){recordsSel2 = recordsMondeFemme;}
		else {recordsSel2 = recordsMondeFemmeJunior;} // TODO autres cat.
	}
		// ---- sexe homme 
	else {
		if (categorie2 == 0){	recordsSel2 = recordsMondeHomme;}
		else if (categorie2 == 1){	recordsSel2 = recordsMondeHommeCadet;}
		else if (categorie2 == 2){	recordsSel2 = recordsMondeHommeJunior;}
		else if (categorie2 == 3){	recordsSel2 = recordsMondeHomme35;}
		else if (categorie2 == 4){	recordsSel2 = recordsMondeHomme40;}
		else if (categorie2 == 5){	recordsSel2 = recordsMondeHomme45;}
		else if (categorie2 == 6){	recordsSel2 = recordsMondeHomme50;}
		else if (categorie2 == 7){	recordsSel2 = recordsMondeHomme55;}
		else if (categorie2 == 8){	recordsSel2 = recordsMondeHomme60;}
		else if (categorie2 == 9){	recordsSel2 = recordsMondeHomme65;}
		else if (categorie2 == 10){	recordsSel2 = recordsMondeHomme70;}
		else if (categorie2 == 11){	recordsSel2 = recordsMondeHomme75;}
		else if (categorie2 == 12){	recordsSel2 = recordsMondeHomme80;}
	}
	} // end monde
	// zone europe 2
	else if (zone2 == 1 && sexe2 == 1){recordsSel2 = recordsEuropeHommeJunior;}
	else if (zone2 == 1 && sexe2 == 0){recordsSel2 = recordsEuropeFemme;}
	
	// zone france 2
	else if (zone2 == 2 && categorie2 == 0 && sexe2 == 1){	recordsSel2 = recordsFranceHomme;}
	else if (zone2 == 2 && categorie2 == 0 && sexe2 == 0){	recordsSel2 = recordsFranceFemme;}
	else if (zone2 == 2 && categorie2 == 2 && sexe2 == 1){	recordsSel2 = recordsFranceHommeJunior;}
	else if (zone2 == 2 && categorie2 == 2 && sexe2 == 0){	recordsSel2 = recordsFranceFemmeJunior;}    
	// zone autre
	else {
		console.log('selection 2 : athlète');
		recordsSel2 = {'record' : []};
	}

    
    var laTable = $("#table_ecarts").DataTable();
    
    laTable.clear();
    
    for (var i = 0; i < recordsSel1.record.length; i++) {
    	var sel1 = recordsSel1.record[i];
    	var sel2 = recordsSel2.record[i];

    	if (sel1 == null || sel2 == null){
    		break;
    	}
    	// supposons sel1.e est 100. On doit chercher sel2.perf correspondant, sinon '0'.
     	sel2 = getRecordEpreuve(sel1.e, recordsSel2.record);

     	if (sel1.e == sel2.e){
	    	var compute = computeEcarts(sel1.perf, sel2.perf);
    		laTable.row.add({e : sel1.e, nom1 : sel1.nom, perf1 :  sel1.perf, nom2 : sel2.nom,  perf2 : sel2.perf, ecart : compute}).draw();
     	}
 	}	
}

function getRecordEpreuve(epr, tabRecords){
	for (var i = 0; i < tabRecords.length; i++) {
		// console.info('test si = ' + tabRecords[i].e);
		if (tabRecords[i].e == epr){
			return tabRecords[i];
		}
	}
	return '0';
}

function createTableHead(){
	
	var records = { data : [
	
	]};
	
	var table = $('#table_ecarts').DataTable({
		data : records.data,
	  columns : [
	    { data: 'e', title: 'Epreuve' },
	    { data: 'nom1', title: 'Nom' },
	    { data: 'perf1', title: 'Performance' },    
	    { data: 'nom2', title: 'Nom' },
	    { data: 'perf2', title: 'Performance' },    
	    { data: 'ecart', title: 'Pourcentage' },
      ]  
	});
	
	selection();
}

function computeEcarts(p1, p2){
	
	var c1 = getCentiemes(p1);
    var c2 = getCentiemes(p2);
    
    if ((p1.indexOf("m", 0) > -1)){
    	return calculEcartCentiemes(c2, c1);
    }
    return calculEcartCentiemes(c1, c2);
}

function getCentiemes(temps) {

	var heures;
	var minutes;
	var secondes;
	var centiemes;

	// '9.58'.indexOf(".", 0)  >> 1;
	// '19.58'.indexOf(".", 0)  >> 2;
	// '9.58'.indexOf(".", 3) >> -1
	// '9.55'.substring(0, 1, 9.55) >> 9;

	// -----------------
	// cas particulier temps sup à 1h
	if (temps.indexOf("h", 0) > -1){
		heures = temps.substring(0, 1);
		minutes = temps.substring(2, 4);
		secondes = temps.substring(3, 5); 
		centiemes = 0;
		
		var i_heures = parseInt(heures);
	    var i_minutes = parseInt(minutes);
		var i_secondes = parseInt(secondes);

	    i_minutes = (i_heures * 60) + i_minutes; 	    
		return ((i_minutes * 60) + i_secondes) * 100;		
	}
	// -----------------
	// cas particulier distance 8m95
	if (temps.indexOf("m", 0) > -1){
		var metres = parseInt(temps.substring(0, 1));
		var centimetres = parseInt(temps.substring(2, 4));
		return (metres * 100) + centimetres;		
	}	
	// -----------------
	// chrono 9.58
	if (temps.length == 4){
		minutes = 0;
		secondes = temps.substring(0, 1);
		centiemes = temps.substring(2, 4);
	}
	// -----------------
	// chrono 10.49, 19.19
	else if (temps.length == 5){
		minutes = 0;
		secondes = temps.substring(0, 2);
		centiemes = temps.substring(3, 5);
	}
	// -----------------
	// chrono 1.53.29
	else if (temps.length == 7){
		minutes = temps.substring(0, 1);
		secondes = temps.substring(2, 4);
		centiemes = temps.substring(5, 7);
	}
	// -----------------
	// chrono 12.58.98
	else if (temps.length == 8){
		minutes = temps.substring(0, 2);
		secondes = temps.substring(3, 5);
		centiemes = temps.substring(6, 8);
	}

    var i_minutes = parseInt(minutes);
	var i_secondes = parseInt(secondes);
	var i_centiemes = parseInt(centiemes);

	return (i_minutes * 60 * 100) + (i_secondes * 100) + i_centiemes;
}

function calculEcartCentiemes(c1, c2) {
    // console.log('calculEcartCentiemes(' + c1 + ',' + c2 + ')');
	return Math.round((c2 / c1) * 10000) / 100; 
    
};

</script>

<script type="text/javascript" class="init">

$('.dropdown-toggle').dropdown();


var recordsSel1 = {'record' : []};
var recordsSel2 = {'record' : []};

var recordsMondeHomme =
{'record' : [
{e : '100', nom : 'Bolt',        perf :  '9.58'}, 
{e : '200', nom : 'Bolt',        perf : '19.19'},
{e : '400', nom : 'Van den Nierk', perf : '43.03'},
{e : '800', nom : 'Rudisha', perf : '1.40.91'},
{e : '1500', nom : 'El Geurrouj', perf : '3.26.00'},
{e : '3000', nom : 'Komen', perf : '7.20.67'},
{e : '5000', nom : 'Bekele', perf : '12.37.35'},
{e : '10000', nom : 'Bekele', perf : '26.17.53'},
{e : 'Marathon', nom : 'Kipchoge', perf : '2h00.25'},
{e : 'Longueur', nom : 'Powell', perf : '8m95'}
]
};


var recordsMondeHommeCadet =
{'record' : [
]
};

var recordsMondeHommeJunior = {'record' : [{e:'100', nom:'Brommel', perf :  '9.97'}, {e : '200', nom : 'Bolt',        perf : '19.93'},
{e : '400', nom : 'Lewis', perf : '43.87'}, {e : '800', nom : 'Amos', perf : '1.41.73'},
{e : '1500', nom : 'Kwemoi', perf : '3.28.81'}, {e : '3000', nom : 'Kejelcha', perf : '7.28.19'},
{e : '5000', nom : 'Gebrhiwet', perf : '12.47.53'}, {e : '10000', nom : 'Wanjiru', perf : '26.41.75'},
{e : 'Marathon', nom : 'Kipchoge', perf : ''}, {e : 'Longueur', nom : 'xxxx', perf : '8m20'}
]
};
 
var recordsMondeHomme35 = {'record' : [{e:'100', nom:'Kim Collins SKN', age:'38', perf:'9.96', annee:'2014'},{e:'200', nom:'Linford Christie GBR', age:'35', perf:'20.11', annee:'1995'},{e:'400', nom:'Christopher Brown BAH', age:'36', perf:'44.54', annee:'2015'},	{e:'800', nom:'Johnny Gray USA', age:'35', perf:'1:43.36', annee:'1995'},		{e:'1500', nom:'Bernard Lagat USA', age:'35', perf:'3:32.51', annee:'2010'},	{e:'3000', nom:'Bernard Lagat USA', age:'35', perf:'7:29.00', annee:'2010'},{e:'5000', nom:'Bernard Lagat USA', age:'36', perf:'12:53.60', annee:'2011'},{e:'10000', nom:'Haile Gebrselassie ETH', age:'35', perf:'26:51.20', annee:'2008'},{e:'3000', nom:'Simon Vroemen NED', age:'36', perf:'8:04.95', annee:'2004'},			{e:'400H', nom:'Danny McFarlane JAM', age:'37', perf:'48.13', annee:'2009'},{e:'Hauteur', nom:'Dragutin Topic SRB', age:'38', perf:'2m31', annee:'2009'},{e:'Perche', nom:'Otto Björn GER', age:'35', perf:'5.90', annee:'2013'},{e:'Longueur', nom:'Myricks - Lewis USA', age:'35', perf:'8.50', annee:'1991'},{e:'Triple', nom:'Jonathan Edwards GBR', age:'35', perf:'17.92', annee:'2001'}]};
var recordsMondeHomme40 = {'record' : [{e:'100', nom:'Kim Collins SKN', age:'40', perf:'9.93', annee:'2016'},{e:'200', nom:'Troy Douglas NED', age:'40', perf:'20.64', annee:'2003'},{e:'400', nom:'Enrico Saraceni ITA', age:'40', perf:'47.81', annee:'2004'},		{e:'800', nom:'Anthony Whiteman GBR', age:'40', perf:'1:48.22', annee:'2012'},	{e:'1500', nom:'Bernard Lagat USA', age:'40', perf:'3:41.87', annee:'2015'},	{e:'3000', nom:'Bernard Lagat USA', age:'40', perf:'7:42.75', annee:'2015'},{e:'5000', nom:'Bernard Lagat USA', age:'41', perf:'13:06.78', annee:'2016'},{e:'10000', nom:'Martti Vainio FIN', age:'40', perf:'28:30.88', annee:'1991'},{e:'3000', nom:'Angelo Carosi ITA', age:'40', perf:'8:38.40', annee:'2004'},					{e:'400H', nom:'Danny McFarlane JAM', age:'40', perf:'49.69', annee:'2012'},{e:'Hauteur', nom:'Dragutin Topic SRB', age:'40', perf:'2m28', annee:'2012'},{e:'Perche', nom:'Jeff Hartwig USA', age:'40', perf:'5.70', annee:'2008'},{e:'Longueur', nom:'Aaron Sampson USA', age:'40', perf:'7.68', annee:'2002'},{e:'Triple', nom:'Ray Kimble USA', age:'40', perf:'16.58', annee:'1993'}]};
var recordsMondeHomme45 = {'record' : [{e:'100', nom:'Willie Gault USA', age:'45', perf:'10.72', annee:'2006'},{e:'200', nom:'Willie Gault USA', age:'47', perf:'21.80', annee:'2008'},{e:'400', nom:'Allen Roy Woodward USA', age:'46', perf:'49.69', annee:'2015'},	{e:'800', nom:'Saladin Allah USA', age:'45', perf:'1:54.18', annee:'2005'},		{e:'1500', nom:'Vyacheslav Shabunin RUS', age:'45', perf:'3:51.22', annee:'2015'},{e:'3000', nom:'Vyacheslav Shavunin RUS', age:'45', perf:'8:15.58', annee:'2015'},{e:'5000', nom:'Lucien Rault FRA', age:'46', perf:'14:23.6', annee:'1982'},{e:'10000', nom:'Antonio Villanueva MEX', age:'45', perf:'30:02.56', annee:'1987'},{e:'3000', nom:'Brad Wilson Barton USA', age:'48', perf:'9:06.68', annee:'2014'},	{e:'400H', nom:'Edward Betts GBR', age:'45', perf:'54.92', annee:'2016'},{e:'Hauteur', nom:'Charles Austin USA', age:'47', perf:'2m05', annee:'2014'},{e:'Perche', nom:'Larry Jessee USA', age:'45', perf:'5.10', annee:'1997'},{e:'Longueur', nom:'Tapani Taavitsainen FIN', age:'46', perf:'7.27', annee:'1990'},{e:'Triple', nom:'Wolfgang Knabe GER', age:'45', perf:'15.13', annee:'2005'}]};
var recordsMondeHomme50 = {'record' : [{e:'100', nom:'Willie Gault USA', age:'50', perf:'10.88', annee:'2011'},{e:'200', nom:'Willie Gault USA', age:'50', perf:'22.44', annee:'2011'},{e:'400', nom:'Fred Sowerby USA', age:'50', perf:'51.39', annee:'1999'},			{e:'800', nom:'Nolan Shaheed USA', age:'50', perf:'1:58.65', annee:'2000'},		{e:'1500', nom:'David Heath GBR', age:'50', perf:'3:58.26', annee:'2015'},		{e:'3000', nom:'Christian Geffrey FRA', age:'50', perf:'8:41.2', annee:'2007'},{e:'5000', nom:'David Martin Rees GBR', age:'50', perf:'14:53.2', annee:'2003'},{e:'10000', nom:'Peter De Vocht BEL', age:'50', perf:'30:55.16', annee:'2010'},{e:'3000', nom:'Nils Undersåker NOR', age:'50', perf:'9:38.8', annee:'1989'},			{e:'400H', nom:'Howard Moscrop GBR', age:'50', perf:'56.56', annee:'2008'},{e:'Hauteur', nom:'Thomas Zacharas GER', age:'50', perf:'1m98', annee:'1997'},{e:'Perche', nom:'Gary Hunter USA', age:'51', perf:'4.75', annee:'2007'},{e:'Longueur', nom:'Tapani Taavitsainen FIN', age:'50', perf:'6.84', annee:'1994'},{e:'Triple', nom:'Wolfgang Knabe GER', age:'50', perf:'14.44', annee:'2009'}]};
var recordsMondeHomme55 = {'record' : [{e:'100', nom:'Bill Collins USA', age:'57', perf:'11.44', annee:'2008'},{e:'200', nom:'Bill Collins USA', age:'55', perf:'23.36', annee:'2006'},{e:'400', nom:'Charles Allie USA', age:'55', perf:'52.24', annee:'2003'},		{e:'800', nom:'Peter Oberliessen GER', age:'55', perf:'2:02.92', annee:'2016'},	{e:'1500', nom:'Keith Bateman AUS', age:'56', perf:'4:12.35', annee:'2011'},	{e:'3000', nom:'Keith Bateman AUS', age:'55', perf:'8:56.80', annee:'2010'},{e:'5000', nom:'Keith Bateman AUS', age:'55', perf:'15:29.7', annee:'2011'},{e:'10000', nom:'Keith Bateman AUS', age:'55', perf:'31:51.86', annee:'2011'},{e:'3000', nom:'Ron Robertson NZL', age:'56', perf:'9:55.05', annee:'1997'},					{e:'400H', nom:'Guido Müeller GER', age:'56', perf:'58.92', annee:'1995'},{e:'Hauteur', nom:'Carlo Tränhardt GER', age:'55', perf:'1m90', annee:'2013'},{e:'Perche', nom:'Wolfgang Ritte GER', age:'55', perf:'4.60', annee:'2008'},{e:'Longueur', nom:'Stig Bäcklund FIN', age:'55', perf:'6.35', annee:'1995'},{e:'Triple', nom:'Wolfgang Knabe GER', age:'55', perf:'14.13', annee:'2014'}]};
var recordsMondeHomme60 = {'record' : [{e:'100', nom:'Ronald Taylor GBR', age:'61', perf:'11.70', annee:'1994'},{e:'200', nom:'Ronald Taylor GBR', age:'61', perf:'24.00', annee:'1994'},{e:'400', nom:'Ralph Romain TRI', age:'63', perf:'53.88', annee:'1995'},		{e:'800', nom:'Nolan Shaheed USA', age:'61', perf:'2:08.56', annee:'2011'},		{e:'1500', nom:'Nolan Shaheed USA', age:'61', perf:'4:24.00', annee:'2011'},	{e:'3000', nom:'Adriaan Heijdens NED', age:'60', perf:'9:29.47', annee:'2000'},{e:'5000', nom:'Adriaan Heijdens NED', age:'60', perf:'16:12.57', annee:'1999'},{e:'10000', nom:'Michael Hager GBR', age:'62', perf:'33:57.6', annee:'2013'},{e:'Hauteur', nom:'Vladimir Kuntsevich RUS', age:'60', perf:'1.81', annee:'2012'},																																								{e:'Perche', nom:'Wolfgang Ritte GER', age:'60', perf:'4.32', annee:'2013'},{e:'Longueur', nom:'Tom Patsalis USA', age:'60', perf:'6m07', annee:'1982'},{e:'Triple', nom:'Stig Bäcklund FIN', age:'60', perf:'12.68', annee:'2000'}]};
var recordsMondeHomme65 = {'record' : [{e:'100', nom:'Stephen Robbins USA', age:'65', perf:'12.37', annee:'2008'},{e:'200', nom:'Charles Allie USA', age:'65', perf:'24.65', annee:'2013'},{e:'400', nom:'Charles Allie USA', age:'65', perf:'56.09', annee:'2013'},	{e:'800', nom:'Earl Fee CAN', age:'66', perf:'2:14.33', annee:'1995'},			{e:'1500', nom:'Simon Herlaar NED', age:'65', perf:'4:39.87', annee:'1994'},	{e:'3000', nom:'Derek Turnbull NZL', age:'65', perf:'9:47.4', annee:'1992'},{e:'5000', nom:'Derek Turnbull NZL', age:'65', perf:'16:38.8', annee:'1992'},{e:'10000', nom:'Derek Turnbull NZL', age:'65', perf:'34:42.2', annee:'1992'},{e:'Hauteur', nom:'Dusan Prezeli SLO', age:'65', perf:'1.67', annee:'2014'},																																								{e:'Perche', nom:'John Altendorf USA', age:'65', perf:'3m89', annee:'2011'},{e:'Longueur', nom:'Lothar Fischer GER', age:'65', perf:'a 5.47', annee:'2001'},{e:'Longueur', nom:'Lamberto Boranga ITA', age:'65', perf:'b 5.47', annee:'2008'},{e:'Triple', nom:'Hermann Strauss GER', age:'65', perf:'11.94', annee:'1996'}]};
var recordsMondeHomme70 = {'record' : [{e:'100', nom:'Bobby Whilden USA', age:'70', perf:'12.77', annee:'2005'},{e:'200', nom:'Glyn Sutton GBR', age:'70', perf:'26.47', annee:'2015'},{e:'400', nom:'Guido Müeller GER', age:'70', perf:'59.34', annee:'2009'},		{e:'800', nom:'Earl Fee CAN', age:'70', perf:'2:20.52', annee:'1999'},			{e:'1500', nom:'Ron Robertson NZL', age:'70', perf:'4:52.95', annee:'2011'},	{e:'3000', nom:'Siem Herlaar NED', age:'70', perf:'10:42.40', annee:'1999'},{e:'5000', nom:'Ron Robertson NZL', age:'70', perf:'18:15.53', annee:'2011'},{e:'10000', nom:'Edward Whitlock CAN', age:'70', perf:'38:04.13', annee:'2001'},{e:'Hauteur', nom:'Carl-Erik Särndal SWE', age:'70', perf:'1.59', annee:'2007'},{e:'Perche', nom:'Robert Brown GBR', age:'70', perf:'3.31', annee:'2002'},{e:'Longueur', nom:'Melvin Larsen USA', age:'70', perf:'5m19', annee:'1994'},{e:'Triple', nom:'Kyushichiro Shimizu JPN', age:'70', perf:'10.71', annee:'2010'},]};
var recordsMondeHomme75 = {'record' : [{e:'100', nom:'Robert Lida USA', age:'75', perf:'13.49', annee:'2012'},{e:'200', nom:'Robert Lida USA', age:'75', perf:'27.73', annee:'2012'},{e:'400', nom:'Guido Müeller GER', age:'75', perf:'62.40', annee:'2014'},			{e:'800', nom:'Jose V.R. Lopez ESP', age:'75', perf:'2:30.59', annee:'2016'},	{e:'1500', nom:'Shichiro Midorikawa JPN', age:'75', perf:'5:22.40', annee:'2007'},{e:'3000', nom:'Edward Whitlock CAN', age:'75', perf:'11:10.43', annee:'2006'},{e:'5000', nom:'Edward Whitlock CAN', age:'75', perf:'19:07.02', annee:'2006'},{e:'10000', nom:'Edward Whitlock CAN', age:'75', perf:'39:25.16', annee:'2006'},{e:'Hauteur', nom:'Carl-Erik Särndal SWE', age:'76', perf:'1.49', annee:'2013'},{e:'Perche', nom:'Don Isett USA', age:'75', perf:'3.20', annee:'2014'},{e:'Longueur', nom:'Saburo Ishigami JPN', age:'75', perf:'4.83', annee:'2005'},{e:'Triple', nom:'Lothar Fischer GER', age:'75', perf:'10.10', annee:'2011'},]};
var recordsMondeHomme80 = {'record' : [{e:'100', nom:'Payton Jordan USA', age:'80', perf:'14.35', annee:'1997'},{e:'200', nom:'Hisamitsu Hijiya JPN', age:'81', perf:'29.54', annee:'2012'},{e:'400', nom:'Hisamitsu Hijiya JPN', age:'81', perf:'70.01', annee:'2012'},{e:'800', nom:'Earl Fee CAN', age:'80', perf:'2:48.95', annee:'2009'},			{e:'1500', nom:'Mauel Alonso Sanchez ESP', age:'80', perf:'5:47.35', annee:'2016'},{e:'3000', nom:'Edward Whitlock CAN', age:'80', perf:'12:13.56', annee:'2011'},{e:'5000', nom:'Edward Whitlock CAN', age:'80', perf:'20:58.12', annee:'2011'},{e:'10000', nom:'Edward Whitlock CAN', age:'80', perf:'42:39.95', annee:'2011'},{e:'Hauteur', nom:'Richard Lowery USA', age:'80', perf:'1.37', annee:'2011'},{e:'Perche', nom:'Bud Held USA', age:'80', perf:'2.75', annee:'2008'},{e:'Longueur', nom:'Saburo Ishigami JPN', age:'80', perf:'4m36', annee:'2010'},{e:'Triple', nom:'Lothar Fischer GER', age:'80', perf:'9.04', annee:'2016'},]};
var recordsMondeHomme85 = {'record' : [{e:'100', nom:'Hiroo Tanaka JPN', age:'85', perf:'15.19', annee:'2016'},{e:'200', nom:'Hiroo Tanaka JPN', age:'85', perf:'31.95', annee:'2016'},{e:'400', nom:'Earl Fee CAN', age:'85', perf:'77.12', annee:'2014'},				{e:'800', nom:'Earl Fee CAN', age:'85', perf:'3:09.10', annee:'2014'},			{e:'1500', nom:'Edward Whitlock CAN', age:'85', perf:'6:38.23', annee:'2016'},	{e:'3000', nom:'Julian Bernal Medina ESP', age:'85', perf:'14:13.4', annee:'2005'},{e:'5000', nom:'Edward Whitlock ITA', age:'85', perf:'24:03.99', annee:'2015'},{e:'10000', nom:'Edward Whitlock CAN', age:'86', perf:'51:07.53', annee:'2016'},{e:'Hauteur', nom:'Samuli Korpi FIN', age:'85', perf:'1.25', annee:'2015'},{e:'Perche', nom:'Carol Johnston USA', age:'85', perf:'2.24', annee:'1997'},{e:'Longueur', nom:'Gudmund Skrivervik NOR', age:'85', perf:'3m77', annee:'2006'},{e:'Triple', nom:'Aatos Saino FIN', age:'85', perf:'8.17', annee:'2010'},]};

var recordsMondeFemme =
{'record' : [{e:'100', nom:'Joyner', perf :  '10.48'}, 
{e:'200', nom : 'Joyner', perf : '21.34'},
{e:'400', nom : 'Koch', perf : '47.60'},
{e:'800', nom : 'Kratochilova', perf : '1.53.28'},
{e:'1500', nom : 'Dibaba G.', perf : '3.50.07'},
{e:'3000', nom : 'Junxia', perf : '8.06.11'},
{e:'5000', nom : 'Dibaba T.', perf : '14.11.15'},
{e:'10000', nom : 'Ayana', perf : '29.17.45'},
{e:'Marathon', nom : 'Radclif', perf : '2h15.25'},
{e:'Longueur', nom : 'Joyner', perf : '7m52'}
]
};

var recordsMondeFemmeCadet =
{'record' : [
]
};

var recordsMondeFemmeJunior =
{'record' : [
{e : '100', nom : 'xxx', perf :  ''}, 
{e : '200', nom : 'xxx', perf : ''},
{e : '400', nom : 'xxx', perf : ''},
{e : '800', nom : 'xxx', perf : ''},
{e : '1500', nom : 'xxx', perf : ''},
{e : '3000', nom : 'xxx', perf : ''},
{e : '5000', nom : 'xxx', perf : ''},
{e : '10000', nom : 'xxx', perf : ''},
{e : 'Marathon', nom : 'xxx', perf : ''},
{e : 'Longueur', nom : 'xxxx', perf : '7m20'}
]
};

var recordsEuropeHommeJunior =
{'record' : [
{e:'100', nom:'LEMAITRE Christophe', perf:'10.04', annee:'2009'},
{e:'200', nom:'HOWE Andrew (Ita)', perf:'20.28', annee:'2004'},
{e:'400', nom:'SCHÖNLEBE Thomas (GDR)', perf:'45.01', annee:'1984'},
{e:'800', nom:'BUSSE Andreas (GDR)', perf:'1.45.45', annee:'1978'},
{e:'1500', nom:'ESTEVES Reyes (ESP)', perf:'3.35.51', annee:'1995'},
{e:'3000', nom:'PAUNONEN Ari (FIN)', perf:'7.43.20', annee:'1977'},
{e:'10000', nom:'LEUPRECHT Christian (ITA)', perf:'28.22.48', annee:'1990'}
]
};

var recordsEuropeFemme =
{'record' : [
{e:'100', nom:'ARRON Christine', perf:'10.73', annee:'9999'},
{e:'200', nom:'SCHIPPERS Dafne (Ned)', perf:'21.63', annee:'9999'},
{e:'400', nom:'KOCH Marita (GDR)', perf:'47.60', annee:'1985'},
{e:'800', nom:'KRATOCHVILOVA Jarmila (TCH)', perf:'1.53.28', annee:'1983'},
{e:'1000', nom:'MASTERKOVA Svetlana (RUS)', perf:'2.28.98', annee:'1996'},
{e:'1500', nom:'KAZANKINA Tatyana (URS)', perf:'3.52.47', annee:'1980'},
{e:'3000', nom:'SZABO Gabriela (ROM)', perf:'8.21.42', annee:'2002'},
{e:'5000', nom:'SHOBUKHOVA Lilia (RUS)', perf:'14.23"75', annee:'2008'},
{e:'10000', nom:'ABEYLEGESSE Elvan (TUR)', perf:'29.56"34', annee:'2008'}
]
};


var recordsFranceHomme =
{'record' : [
{e : '100', nom : 'Vicaud',        perf :  '9.86'}, 
{e : '200', nom : 'Lemaitre',        perf : '19.80'},
{e : '400', nom : 'Djhone', perf : '44.46'},
{e : '800', nom : 'Boss', perf : '1.42.53'},
{e : '1500', nom : 'Baala', perf : '3.28.98'},
{e : '3000', nom : 'Essaid', perf : '7.30.78'},
{e : '5000', nom : 'Sghir', perf : '12.58.83'},
{e : '10000', nom : 'Martins', perf : '27.22.78'},
{e : 'Marathon', nom : 'Zwierchewski', perf : '2h06.35'},
{e : 'Longueur', nom : 'Klouchi', perf : '8m42'}
]
};

var recordsFranceHommeJunior =
{'record' : [
{e : '100', nom : 'xxx', perf :  ''}, 
{e : '200', nom : 'xxx', perf : ''},
{e : '400', nom : 'xxx', perf : ''},
{e : '800', nom : 'xxx', perf : ''},
{e : '1500', nom : 'xxx', perf : ''},
{e : '3000', nom : 'xxx', perf : ''},
{e : '5000', nom : 'xxx', perf : ''},
{e : '10000', nom : 'xxx', perf : ''},
{e : 'Marathon', nom : 'xxx', perf : ''},
{e : 'Longueur', nom : 'xxxx', perf : '8m20'}
]
};
    
var recordsFranceFemme =
{'record' : [
{e : '100', nom : 'Arron',  perf :  '10.73'}, 
{e : '200', nom : 'Pérec', perf : '21.99'},
{e : '400', nom : 'Pérec', perf : '48.25'},
{e : '800', nom : 'Djaté', perf : '1.56.53'},
{e : '1500', nom : 'Dehiba', perf : '3.59.76'},
{e : '3000', nom : 'Ghezielle', perf : '8.35.41'},
{e : '5000', nom : 'Maury', perf : '14.43.90'},
{e : '10000', nom : 'Daunay', perf : '31.35.81'},
{e : 'Marathon', nom : 'Daunay', perf : '2h25.00'},
{e : 'Longueur', nom : 'Barber', perf : '7m05'}
]
};

var recordsFranceFemmeJunior =
{'record' : [
{e : '100', nom : 'xxx', perf :  ''}, 
{e : '200', nom : 'xxx', perf : ''},
{e : '400', nom : 'xxx', perf : ''},
{e : '800', nom : 'xxx', perf : ''},
{e : '1500', nom : 'xxx', perf : ''},
{e : '3000', nom : 'xxx', perf : ''},
{e : '5000', nom : 'xxx', perf : ''},
{e : '10000', nom : 'xxx', perf : ''},
{e : 'Marathon', nom : 'xxx', perf : ''},
{e : 'Longueur', nom : 'xxxx', perf : '6m80'}
]
};

// chaine = chaine.substring(1);

var listeEpreuves = ['100', '200', '400', '800', '1500', '3000', '5000', '10000', 'Marathon', 'Longueur', 'Triple'];



createTableHead();

var elts = document.querySelectorAll("select");
for (var i = 0; i < elts.length; i++){
	elts[i].addEventListener("change", selection, true);
}

$("#searchClub2").on("input", function(e) {
	var val = $(this).val();
	if(val === ""){
		return;
	}

	$.get("getClub.php", {q:val}, function(listeClubs) {

		var dataList = $("#listeClub2");
		dataList.empty();
		
		for (var i = 0; i < listeClubs.clubs.length; i++) {
			var obj = listeClubs.clubs[i];
			console.log(obj.c);
			var opt = $("<option></option>").attr("value", obj.c);
			dataList.append(opt);
		}
	},"json");
});

function chargeAthlete1(){
	chargeJsonAthlete1($("#nom1")[0].value);
}
function chargeAthlete2(){
	console.log($("#textNom2")[0].value);			
	chargeJsonAthlete2($("#textNom2")[0].value);
}

function chargeJsonAthlete1(p_nom){
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
		 if (this.readyState == 4 && this.status == 200) {
			 var reponseGetRecords = this.responseText;
			 
			 var jsonData = JSON.parse(reponseGetRecords);

			 recordsSel1 = jsonData;

			 var laTable = $("#table_ecarts").DataTable();
			 
			 laTable.clear();
			 
			 for (var i = 0; i < listeEpreuves.length; i++) {

				var sel1 = getRecordOfEpreuve(listeEpreuves[i], recordsSel1);
				var sel2 = getRecordOfEpreuve(listeEpreuves[i], recordsSel2);

				var compute = computeEcarts(sel1.perf, sel2.perf);
				laTable.row.add({e : sel1.e, nom1 : sel1.nom, perf1 :  sel1.perf, nom2 : sel2.nom,  perf2 : sel2.perf, ecart : compute}).draw();      
			 }
		 }
	 };
	 xmlhttp.open("GET", "getRecords.php?q=" + p_nom, true);
	 xmlhttp.send();
}

function getRecordOfEpreuve(epreuve, recordsJson){

	for(var i = 0; i < recordsJson.record.length; i++){
		if(recordsJson.record[i].e == epreuve){
			var p = recordsJson.record[i].perf;
			if (p.startWith("0")){
				return p.substring(1);
			}
			return p;
		}
	}
	return '';
}

		
function chargeJsonAthlete2(p_nom){
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
	if (this.readyState == 4 && this.status == 200) {

			var reponseGetRecords = this.responseText;
			var jsonData = JSON.parse(reponseGetRecords);
			recordsSel2 = jsonData;
			var laTable = $("#table_ecarts").DataTable();
			laTable.clear();

			for (var i = 0; i < recordsSel2.record.length; i++) {
				var sel1 = recordsSel1.record[i];
				var sel2 = recordsSel2.record[i];

				var compute = computeEcarts(sel1.perf, sel2.perf);
				laTable.row.add({e : sel1.e, nom1 : sel1.nom, perf1 :  sel1.perf, nom2 : sel2.nom,  perf2 : sel2.perf, ecart : compute}).draw();
			}
		}
	};
	xmlhttp.open("GET", "getRecords.php?q=" + p_nom, true);
	xmlhttp.send();
}

// idSpan : txtHint
function showHint(str, idSpan) {
    if (str.length < 3) { 
        document.getElementById(idSpan).innerHTML = "";
        return;
    } else {
    	var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var nom = this.responseText;
                document.getElementById(idSpan).innerHTML = nom;
            }
        };
        xmlhttp.open("GET", "getNom.php?q=" + str, true);
        xmlhttp.send();

    }
    
}
</script>
<script>
	document.getElementById("statistiques").setAttribute("class", "active");
	
	$('.alphaonly').bind('keyup blur', function() {
		var node = $(this);
		node.val(node.val().replace(/[^A-Za-z ]/g, ''));
	});
</script>
	
	
</body>
</html>