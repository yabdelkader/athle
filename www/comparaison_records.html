<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="css/bootstrap.min.css" media="screen, projection" rel="stylesheet" type="text/css" />
<link href="css/dataTables.bootstrap.min.css" media="screen, projection" rel="stylesheet" type="text/css" />

<script src="js/jquery-1.12.3.js" type="text/javascript"></script>
<script src="js/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="js/dataTables.bootstrap.min.js"></script>
<script src="js/bootstrap.min.js" type="text/javascript"></script>
<!-- src="charts/google/jsapi?autoload={'modules':[{'name':'visualization','version':'1','packages':['corechart']}]}"  -->
<script type="text/javascript" src="charts/google/format+fr,default+fr,ui+fr,corechart+fr.I.js"></script>


<script src="js/recordsMonde.js" type="text/javascript"></script>
<script src="js/recordsFrance.js" type="text/javascript"></script>
</head>

<body>
	<div class="content">

		<div class="col-sm-2"></div>
		<div class="col-sm-8">

			<div id="menu"></div>
			<h1>Comparaisons de records - écarts en pourcentage</h1>

<div class="row">

	<!-- div selection1 -->
	<div class="form-group col-sm-5">
	
	<label>Records de la 1ère sélection</label>
	<select id="selectZone1" class="form-control">
		<option value="1" selected="selected">Monde</option>
		<option value="2">France</option>
		<option value="3">Club</option>
		<option value="4">Athlète</option>

	</select>
	<select id="selectSexe1" class="form-control">
		<option>Femme</option>
		<option selected="selected">Homme</option>
	</select>	
	<select id="selectCategorie1" class="form-control">
		<option>Toutes catégories</option>
		<option>Cadet</option>
		<option>Junior</option>
		<option selected="selected">35</option>
		<option>40</option>
		<option>45</option>
		<option>50</option>
		<option>55</option>
		<option>60</option>
		<option>65</option>
		<option>70</option>
		<option>75</option>
		<option>80</option>
	</select>

	<div id="divClub1" style="display:none">
		<label for="club1" class="col-sm-3 control-label">Club</label>
		<div class="col-sm-3">
		 	<input type="text" name="searchClub1" id="searchClub1" placeholder="saisissez le début du nom" list="listeClub1"
		 	 autocomplete="off" style="width: 250px;"/>
			<datalist id="listeClub1"></datalist>
			<button class="btn btn-primary btn-sm" onclick="chargeClub1();">OK</button>
		</div>
		
	</div>
			 
	<br/><br/>

	<div id="divAthlete1" style="display:none">
		<label for="textNom1" class="col-sm-2 control-label">Nom</label>
		<div class="col-sm-5">
			<input type="text" class="alphaonly form-control" id="textNom1" name="textNom1" placeholder="nom" onkeyup="showHint(this.value, 'txtHint1')" size="20" maxlength="20" />
		</div>
		<div class="col-sm-5"><span id="txtHint1"></span></div>		
		
		<br/><br/>

		<label for="prenom1" class="col-sm-2 control-label">Prénom</label>
		
		<div class="col-sm-5">
			<input type="search" class="alphaonly form-control" name="prenom1" placeholder="prénom" size="20" maxlength="20" />
		</div>
		<div class="col-sm-5"><span id="txtHint1Prenom"></span></div>
		<div class="col-sm-1"><button class="btn btn-primary btn-sm" onclick="chargeAthlete1();">OK</button></div>
	</div>
	</div> <!-- end selection 1 -->

	<!-- selection 2 -->
	<div class="form-group col-sm-5">
	<label>Records de la 2nde sélection</label>
	<select id="selectZone2" class="form-control">
		<option selected="selected" value="1">Monde</option>
		<option value="2">France</option>
		<option value="3">Club</option>
		<option value="4">Athlète</option>
	</select>
	<select id="selectSexe2" class="form-control">
		<option selected="selected">Femme</option>
		<option>Homme</option>
	</select>	
	<select id="selectCategorie2" class="form-control">
		<option selected="selected">Toutes catégories</option>
		<option>Cadet</option>
		<option>Junior</option>
		<option>35</option>
		<option>40</option>
		<option>45</option>
		<option>50</option>
		<option>55</option>
		<option>60</option>
		<option>65</option>
		<option>70</option>
		<option>75</option>
		<option>80</option>

	</select>

	<div id="divClub2" style="display:none">
		<label for="club2" class="col-sm-3 control-label">Club</label>
		<div class="col-sm-5">
		 	<input type="text" name="searchClub2" id="searchClub2" placeholder="saisissez le début du nom" list="listeClub2"
		 	 autocomplete="off" style="width: 250px;"/>
			<datalist id="listeClub2"></datalist>	
		</div>
		<div class="col-sm-1"><button class="btn btn-primary btn-sm" onclick="chargeClub2();">OK</button></div>
	</div>
			 
			 <br/><br/>

	<div id="divAthlete2"> <!--  style="display:none"> -->
		 	 		
		<label for="textNom2" class="col-sm-2 control-label">Nom</label>
		<div class="col-sm-5">
			<input type="text" class="alphaonly form-control" id="textNom2" name="textNom2" placeholder="nom" onkeyup="showHint(this.value, 'txtHint2')"
		 size="20" maxlength="20" />
		</div>
		<div class="col-sm-5"><span id="txtHint2"></span></div>		
				
		<br/><br/>
	
		<label for="prenom2" class="col-sm-2 control-label">Prénom</label>
		<div class="col-sm-5">
			<input type="search" class="alphaonly form-control" name="prenom2" placeholder="prénom" size="20" maxlength="20" />
		</div>
		<div class="col-sm-5"><span id="txtHint2Prenom"></span></div> 		
		<div class="col-sm-1"><button class="btn btn-primary btn-sm" onclick="chargeAthlete2();">OK</button></div>
		</div> 
	</div>
<!--  </form>  -->
</div> <!-- END row -->
<br/>


		<button id="btnShowHide" class="btn btn-primary">Masquer / montrer graphique</button>
       <div id="chart_div" style="width: 900px; height: 500px;"></div>

<script type="text/javascript">
var button = document.getElementById('btnShowHide'); // Assumes element with id='button'

button.onclick = function() {
    var div = document.getElementById('chart_div');
    if (div.style.display !== 'none') {
        div.style.display = 'none';
    }
    else {
        div.style.display = 'block';
    }
};

google.setOnLoadCallback(drawChart);
function drawChart() {
	var tableCalculee = [];
                     
	tableCalculee.push(['Epreuve', libelleSel1, libelleSel2]);
     
	for (var i = 0; i < listeEpreuves.length; i++) {

		var sel1 = getRecordOfEpreuve(listeEpreuves[i], recordsSel1);
		var sel2 = getRecordOfEpreuve(listeEpreuves[i], recordsSel2);

		var ecart = computeEcarts(sel1.perf, sel2.perf);
		
		if (ecart.length === 0){
			ecart = 0;
		}
		tableCalculee.push([listeEpreuves[i], 100, ecart]);
	}
	var data = google.visualization.arrayToDataTable(tableCalculee);

	var options = {
		title: 'Comparatif'
    };

	var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

	chart.draw(data, options);
}
   </script>

	<table class="table table-striped table-bordered" id="table_ecarts"></table>

		</div>
	</div>

	<script src="js/menu.js" type="text/javascript"></script>
	
	


<script type="text/javascript">

function selection(){
	
    $("#table_ecarts tbody").children().remove();
    
    var zone1 = document.getElementById("selectZone1").selectedIndex;
	var zone2 = document.getElementById("selectZone2").selectedIndex;
	var categorie1 = document.getElementById("selectCategorie1").selectedIndex;
	var categorie2 = document.getElementById("selectCategorie2").selectedIndex;
	var sexe1 = document.getElementById("selectSexe1").selectedIndex;
	var sexe2 = document.getElementById("selectSexe2").selectedIndex;
	
	console.log(zone1 + ' ' + categorie1 + ' ' + sexe1 + ' ' + zone2 + ' ' + categorie2 + ' ' + sexe2);

	// Par défaut on masque les div "Club" et "Athlete"
	$("#divClub1").css({'display' : 'none'});	
	$("#divAthlete1").css({'display' : 'none'});
	$("#selectCategorie1").css({'display' : ''});
	$("#selectSexe1").css({'display' : ''});

	$("#divClub2").css({'display' : 'none'});	
	$("#divAthlete2").css({'display' : 'none'});
	$("#selectCategorie2").css({'display' : ''});
	$("#selectSexe2").css({'display' : ''});

	// ======= ZONE 1 =======
	// Si selection "Club" alors on montre input club et on laisse sexe - catégorie
	if(zone1 == 2){
		$("#divClub1").css({'display' : ''});	
	}
	// Si selection "Athlete" alors on montre inuput athle et on masque sexe - categorie
	else if(zone1 == 3){
		$("#divAthlete1").css({'display' : ''});
		$("#selectCategorie1").css({'display' : 'none'});
		$("#selectSexe1").css({'display' : 'none'});
	}
	// ======= ZONE 2 =======
	// Si selection "Club" alors on montre input club et on laisse sexe - catégorie
	if(zone2 == 2){
		$("#divClub2").css({'display' : ''});	
	}
	// Si selection "Athlete" alors on montre inuput athle et on masque sexe - categorie
	else if(zone2 == 3){
		$("#divAthlete2").css({'display' : ''});
		$("#selectCategorie2").css({'display' : 'none'});
		$("#selectSexe2").css({'display' : 'none'});
	}

    // ---- SELECTION 1 ----
	// zone monde 0
	// -------- categorie all
    if (zone1 == 0) {
    	
	// ---- sexe femme  
		if (sexe1 == 0){
			
			if (categorie1 == 0){recordsSel1 = recordsMondeFemme;}
			else if (categorie1 == 1){	recordsSel1 = recordsMondeFemmeCadet;}
			else if (categorie1 == 2){	recordsSel1 = recordsMondeFemmeJunior;}
			else if (categorie1 == 3){	recordsSel1 = recordsMondeFemme35;}
			else if (categorie1 == 4){	recordsSel1 = recordsMondeFemme40;}
			else if (categorie1 == 5){	recordsSel1 = recordsMondeFemme45;}
			else if (categorie1 == 6){	recordsSel1 = recordsMondeFemme50;}
			else if (categorie1 == 7){	recordsSel1 = recordsMondeFemme55;}
			else if (categorie1 == 8){	recordsSel1 = recordsMondeFemme60;}
			else if (categorie1 == 9){	recordsSel1 = recordsMondeFemme65;}
			else if (categorie1 == 10){	recordsSel1 = recordsMondeFemme70;}
			else if (categorie1 == 11){	recordsSel1 = recordsMondeFemme75;}
			else if (categorie1 == 12){	recordsSel1 = recordsMondeFemme80;}
		}
		// ---- sexe homme 
		else {
			if (categorie1 == 0){	recordsSel1 = recordsMondeHomme;}
			else if (categorie1 == 1){	recordsSel1 = recordsMondeHommeCadet;}
			else if (categorie1 == 2){	recordsSel1 = recordsMondeHommeJunior;}
			else if (categorie1 == 3){	recordsSel1 = recordsMondeHomme35;}
			else if (categorie1 == 4){	recordsSel1 = recordsMondeHomme40;}
			else if (categorie1 == 5){	recordsSel1 = recordsMondeHomme45;}
			else if (categorie1 == 6){	recordsSel1 = recordsMondeHomme50;}
			else if (categorie1 == 7){	recordsSel1 = recordsMondeHomme55;}
			else if (categorie1 == 8){	recordsSel1 = recordsMondeHomme60;}
			else if (categorie1 == 9){	recordsSel1 = recordsMondeHomme65;}
			else if (categorie1 == 10){	recordsSel1 = recordsMondeHomme70;}
			else if (categorie1 == 11){	recordsSel1 = recordsMondeHomme75;}
			else if (categorie1 == 12){	recordsSel1 = recordsMondeHomme80;}
		}
	} // end monde
	// ===============================
	// zone france 1
	else if (zone1 == 1){
	// ---- sexe femme  
		if (sexe1 == 0){
			if (categorie1 == 0){recordsSel1 = recordsFranceFemme;}
			else if (categorie1 == 1){	recordsSel1 = recordsFranceFemmeCadet;}
			else if (categorie1 == 2){	recordsSel1 = recordsFranceFemmeJunior;}
			else if (categorie1 == 3){	recordsSel1 = recordsFranceFemme35;}
			else if (categorie1 == 4){	recordsSel1 = recordsFranceFemme40;}
			else if (categorie1 == 5){	recordsSel1 = recordsFranceFemme45;}
			else if (categorie1 == 6){	recordsSel1 = recordsFranceFemme50;}
			else if (categorie1 == 7){	recordsSel1 = recordsFranceFemme55;}
			else if (categorie1 == 8){	recordsSel1 = recordsFranceFemme60;}
			else if (categorie1 == 9){	recordsSel1 = recordsFranceFemme65;}
			else if (categorie1 == 10){	recordsSel1 = recordsFranceFemme70;}
			else if (categorie1 == 11){	recordsSel1 = recordsFranceFemme75;}
			else if (categorie1 == 12){	recordsSel1 = recordsFranceFemme80;}
		}
		// ---- sexe homme 
		else {
			if (categorie1 == 0){	recordsSel1 = recordsFranceHomme;}
			else if (categorie1 == 1){	recordsSel1 = recordsFranceHommeCadet;}
			else if (categorie1 == 2){	recordsSel1 = recordsFranceHommeJunior;}
			else if (categorie1 == 3){	recordsSel1 = recordsFranceHomme35;}
			else if (categorie1 == 4){	recordsSel1 = recordsFranceHomme40;}
			else if (categorie1 == 5){	recordsSel1 = recordsFranceHomme45;}
			else if (categorie1 == 6){	recordsSel1 = recordsFranceHomme50;}
			else if (categorie1 == 7){	recordsSel1 = recordsFranceHomme55;}
			else if (categorie1 == 8){	recordsSel1 = recordsFranceHomme60;}
			else if (categorie1 == 9){	recordsSel1 = recordsFranceHomme65;}
			else if (categorie1 == 10){	recordsSel1 = recordsFranceHomme70;}
			else if (categorie1 == 11){	recordsSel1 = recordsFranceHomme75;}
			else if (categorie1 == 12){	recordsSel1 = recordsFranceHomme80;}
		}		
	}
	// zone 2 ou 3 : athlte ou club
	else {
		console.log('selection 1 : athlète ou club');
		recordsSel1 = {'record' : []};
	}

    // ---- SELECTION 2 ----
    	// zone monde 0
	// -------- categorie all
	// zone monde 0
	// -------- categorie all
    if (zone2 == 0) {

	// ---- sexe femme  
	if (sexe2 == 0){
		if (categorie2 == 0){recordsSel2 = recordsMondeFemme;}
		else if (categorie2 == 1){	recordsSel2 = recordsMondeFemmeCadet;}
		else if (categorie2 == 2){	recordsSel2 = recordsMondeFemmeJunior;}
		else if (categorie2 == 3){	recordsSel2 = recordsMondeFemme35;}
		else if (categorie2 == 4){	recordsSel2 = recordsMondeFemme40;}
		else if (categorie2 == 5){	recordsSel2 = recordsMondeFemme45;}
		else if (categorie2 == 6){	recordsSel2 = recordsMondeFemme50;}
		else if (categorie2 == 7){	recordsSel2 = recordsMondeFemme55;}
		else if (categorie2 == 8){	recordsSel2 = recordsMondeFemme60;}
		else if (categorie2 == 9){	recordsSel2 = recordsMondeFemme65;}
		else if (categorie2 == 10){	recordsSel2 = recordsMondeFemme70;}
		else if (categorie2 == 11){	recordsSel2 = recordsMondeFemme75;}
		else if (categorie2 == 12){	recordsSel2 = recordsMondeFemme80;}
	}
		// ---- sexe homme 
	else {
		if (categorie2 == 0){	recordsSel2 = recordsMondeHomme;}
			else if (categorie2 == 1){	recordsSel2 = recordsMondeHommeCadet;}
			else if (categorie2 == 2){	recordsSel2 = recordsMondeHommeJunior;}
			else if (categorie2 == 3){	recordsSel2 = recordsMondeHomme35;}
			else if (categorie2 == 4){	recordsSel2 = recordsMondeHomme40;}
			else if (categorie2 == 5){	recordsSel2 = recordsMondeHomme45;}
			else if (categorie2 == 6){	recordsSel2 = recordsMondeHomme50;}
			else if (categorie2 == 7){	recordsSel2 = recordsMondeHomme55;}
			else if (categorie2 == 8){	recordsSel2 = recordsMondeHomme60;}
			else if (categorie2 == 9){	recordsSel2 = recordsMondeHomme65;}
			else if (categorie2 == 10){	recordsSel2 = recordsMondeHomme70;}
			else if (categorie2 == 11){	recordsSel2 = recordsMondeHomme75;}
			else if (categorie2 == 12){	recordsSel2 = recordsMondeHomme80;}
		}
	} // end monde
	// ===============================
	// zone france 1
	else if (zone2 == 1){
	// ---- sexe femme  
		if (sexe2 == 0){
			if (categorie2 == 0){recordsSel2 = recordsFranceFemme;}
			else if (categorie2 == 1){	recordsSel2 = recordsFranceFemmeCadet;}
			else if (categorie2 == 2){	recordsSel2 = recordsFranceFemmeJunior;}
			else if (categorie2 == 3){	recordsSel2 = recordsFranceFemme35;}
			else if (categorie2 == 4){	recordsSel2 = recordsFranceFemme40;}
			else if (categorie2 == 5){	recordsSel2 = recordsFranceFemme45;}
			else if (categorie2 == 6){	recordsSel2 = recordsFranceFemme50;}
			else if (categorie2 == 7){	recordsSel2 = recordsFranceFemme55;}
			else if (categorie2 == 8){	recordsSel2 = recordsFranceFemme60;}
			else if (categorie2 == 9){	recordsSel2 = recordsFranceFemme65;}
			else if (categorie2 == 10){	recordsSel2 = recordsFranceFemme70;}
			else if (categorie2 == 11){	recordsSel2 = recordsFranceFemme75;}
			else if (categorie2 == 12){	recordsSel2 = recordsFranceFemme80;}
		}
		// ---- sexe homme 
		else {
			if (categorie2 == 0){	recordsSel2 = recordsFranceHomme;}
			else if (categorie2 == 1){	recordsSel2 = recordsFranceHommeCadet;}
			else if (categorie2 == 2){	recordsSel2 = recordsFranceHommeJunior;}
			else if (categorie2 == 3){	recordsSel2 = recordsFranceHomme35;}
			else if (categorie2 == 4){	recordsSel2 = recordsFranceHomme40;}
			else if (categorie2 == 5){	recordsSel2 = recordsFranceHomme45;}
			else if (categorie2 == 6){	recordsSel2 = recordsFranceHomme50;}
			else if (categorie2 == 7){	recordsSel2 = recordsFranceHomme55;}
			else if (categorie2 == 8){	recordsSel2 = recordsFranceHomme60;}
			else if (categorie2 == 9){	recordsSel2 = recordsFranceHomme65;}
			else if (categorie2 == 10){	recordsSel2 = recordsFranceHomme70;}
			else if (categorie2 == 11){	recordsSel2 = recordsFranceHomme75;}
			else if (categorie2 == 12){	recordsSel2 = recordsFranceHomme80;}
		}		
	}

	// zone 2 ou 3 : athlete ou club
	else {
		console.log('selection 2 : athlète ou club');
		recordsSel2 = {'record' : []};
	}
    
    libelleSel1 = getLibelle(zone1, sexe1, categorie1);
    libelleSel2 = getLibelle(zone2, sexe2, categorie2);
    
	var laTable = $("#table_ecarts").DataTable();

	laTable.clear();
	
	for (var i = 0; i < listeEpreuves.length; i++) {

		var sel1 = getRecordOfEpreuve(listeEpreuves[i], recordsSel1);
		var sel2 = getRecordOfEpreuve(listeEpreuves[i], recordsSel2);

		if (sel1.length == 0 && sel2.length == 0){
			// rien, pas de record ni pour aucun des deux athlètes
		}
		// sel1 null, sel2 non null
		else if (sel1.length == 0){
			laTable.row.add({e : listeEpreuves[i], nom1 : '', perf1 :  '', nom2 : sel2.nom,  perf2 : sel2.perf, ecart : ''}).draw();
		}
		// sel1 non null, sel2 null
		else if (sel2.length == 0){
			laTable.row.add({e : listeEpreuves[i], nom1 : sel1.nom, perf1 :  sel1.perf, nom2 : '',  perf2 : '', ecart : ''}).draw();
		}
		// les deux athlètes avec perf
		else {
			var compute = computeEcarts(sel1.perf, sel2.perf);
			laTable.row.add({e : listeEpreuves[i], nom1 : sel1.nom, perf1 :  sel1.perf, nom2 : sel2.nom,  perf2 : sel2.perf, ecart : compute}).draw();
		}
	}
	
	drawChart();
}

function getLibelle(zone, sexe, categorie, nom){
	
	var str = "";
	
	if (zone === 0){
		str = 'Records monde';
	}
	else if (zone === 1){
		str = 'Records france';
	}
	else {
		return 'Records ' + nom;
	}
	
	if (sexe === 0){
		str = str + " femme";
	}
	else {
		str = str + " homme";
	}

	if (categorie === 0){
		// str = str + " ";
	}
	else if (categorie === 1){ 	str = str + " cadets"; 	}
	else if (categorie === 2){ 	str = str + " junior"; 	}
	else if (categorie === 3){ 	str = str + " master 35"; 	}
	else if (categorie === 4){ 	str = str + " master 40"; 	}
	else if (categorie === 5){ 	str = str + " master 45"; 	}
	else if (categorie === 6){ 	str = str + " master 50"; 	}
	else if (categorie === 7){ 	str = str + " master 55"; 	}

	
	return str;
}

function getRecordEpreuve(epr, tabRecords){
	for (var i = 0; i < tabRecords.length; i++) {
		// console.info('test si = ' + tabRecords[i].e);
		if (tabRecords[i].e == epr){
			return tabRecords[i];
		}
	}
	return '0';
}

function createTableHead(){
	
	var records = { data : [
	
	]};
	
	var table = $('#table_ecarts').DataTable({
		data : records.data,
	  columns : [
	    { data: 'e', title: 'Epreuve' },
	    { data: 'nom1', title: 'Nom' },
	    { data: 'perf1', title: 'Performance' },    
	    { data: 'nom2', title: 'Nom' },
	    { data: 'perf2', title: 'Performance' },    
	    { data: 'ecart', title: 'Pourcentage' },
      ]  
	});
	
	selection();
}

function computeEcarts(p1, p2){
	
	if (p1 == null || p2 == null){
		return "";
	}
	
	var c1 = getCentiemes(p1);
    var c2 = getCentiemes(p2);
    
    if ((p1.indexOf("m", 0) > -1)){
    	return calculEcartCentiemes(c2, c1);
    }
    return calculEcartCentiemes(c1, c2);
}

function getCentiemes(temps) {

	if (temps == null){
		return 0;
	}

	var heures;
	var minutes;
	var secondes;
	var centiemes;

	// '9.58'.indexOf(".", 0)  >> 1;
	// '19.58'.indexOf(".", 0)  >> 2;
	// '9.58'.indexOf(".", 3) >> -1
	// '9.55'.substring(0, 1, 9.55) >> 9;

	// -----------------
	// cas particulier temps sup à 1h
	if (temps.indexOf("h", 0) > -1){
		heures = temps.substring(0, 1);
		minutes = temps.substring(2, 4);
		secondes = temps.substring(3, 5); 
		centiemes = 0;
		
		var i_heures = parseInt(heures);
	    var i_minutes = parseInt(minutes);
		var i_secondes = parseInt(secondes);

	    i_minutes = (i_heures * 60) + i_minutes; 	    
		return ((i_minutes * 60) + i_secondes) * 100;		
	}
	// -----------------
	// cas particulier distance 8m95 ou 17m92
	if (temps.indexOf("m", 0) > -1){
		if (temps.length == 4){ // longueur
			var metres = parseInt(temps.substring(0, 1));
			var centimetres = parseInt(temps.substring(2, 4));
			return (metres * 100) + centimetres;
		}
		// triple ou lancers
			var metres = parseInt(temps.substring(0, 2));
			var centimetres = parseInt(temps.substring(3, 5));
			return (metres * 100) + centimetres;
	}	
	// -----------------
	// chrono 9.58
	if (temps.length == 4){
		minutes = 0;
		secondes = temps.substring(0, 1);
		centiemes = temps.substring(2, 4);
	}
	// -----------------
	// chrono 10.49, 19.19
	else if (temps.length == 5){
		minutes = 0;
		secondes = temps.substring(0, 2);
		centiemes = temps.substring(3, 5);
	}
	// -----------------
	// chrono 1.53.29
	else if (temps.length == 7){
		minutes = temps.substring(0, 1);
		secondes = temps.substring(2, 4);
		centiemes = temps.substring(5, 7);
	}
	// -----------------
	// chrono 12.58.98
	else if (temps.length == 8){
		minutes = temps.substring(0, 2);
		secondes = temps.substring(3, 5);
		centiemes = temps.substring(6, 8);
	}

    var i_minutes = parseInt(minutes);
	var i_secondes = parseInt(secondes);
	var i_centiemes = parseInt(centiemes);

	return (i_minutes * 60 * 100) + (i_secondes * 100) + i_centiemes;
}

function calculEcartCentiemes(c1, c2) {
    // console.log('calculEcartCentiemes(' + c1 + ',' + c2 + ')');
	return Math.round((c2 / c1) * 10000) / 100; 
    
};

</script>

<script type="text/javascript" class="init">

$('.dropdown-toggle').dropdown();


var recordsSel1 = {'record' : []};
var recordsSel2 = {'record' : []};

var libelleSel1 = 'sel1 init';
var libelleSel2 = 'sel2 init';



var listeEpreuves = ['100', '200', '400', '800', '1500', '3000', '5000', '10000', 'Marathon', '400 Haies', 'Steeple', 'Longueur', 'Triple saut'];



createTableHead();

var elts = document.querySelectorAll("select");
for (var i = 0; i < elts.length; i++){
	elts[i].addEventListener("change", selection, true);
}

$("#searchClub2").on("input", function(e) {
	var val = $(this).val();
	if(val === ""){
		return;
	}

	$.get("getClub.php", {q:val}, function(listeClubs) {

		var dataList = $("#listeClub2");
		dataList.empty();
		
		for (var i = 0; i < listeClubs.clubs.length; i++) {
			var obj = listeClubs.clubs[i];
			console.log(obj.c);
			var opt = $("<option></option>").attr("value", obj.c);
			dataList.append(opt);
		}
	},"json");
});

function chargeClub1(){
	chargeJsonClub($("#textNom1")[0].value, 1);
}
function chargeClub2(){
	chargeJsonClub($("#textNom2")[0].value, 2);
}

function chargeAthlete1(){
	chargeJsonAthlete($("#textNom1")[0].value, 1);
}
function chargeAthlete2(){
	chargeJsonAthlete($("#textNom2")[0].value, 2);
}


function chargeJsonClub(p_nom, numClub){
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
		 if (this.readyState == 4 && this.status == 200) {
			 var reponseGetRecords = this.responseText;
			 
			 var jsonData = JSON.parse(reponseGetRecords);

			 if (numAthlete == 1){
				recordsSel1 = jsonData;
			} else {
				recordsSel2 = jsonData;
			}

			 var laTable = $("#table_ecarts").DataTable();
			 
			 laTable.clear();
			 
			 for (var i = 0; i < listeEpreuves.length; i++) {

				var sel1 = getRecordOfEpreuve(listeEpreuves[i], recordsSel1);
				var sel2 = getRecordOfEpreuve(listeEpreuves[i], recordsSel2);

				if (sel1.length == 0 && sel2.length == 0){
					// rien, pas de record ni pour aucun des deux athlètes
				}
				// sel1 null, sel2 non null
				else if (sel1.length == 0){
					laTable.row.add({e : listeEpreuves[i], nom1 : '', perf1 :  '', nom2 : sel2.nom,  perf2 : sel2.perf, ecart : ''}).draw();
				}
				// sel1 non null, sel2 null
				else if (sel2.length == 0){
					laTable.row.add({e : listeEpreuves[i], nom1 : sel1.nom, perf1 :  sel1.perf, nom2 : '',  perf2 : '', ecart : ''}).draw();
				}
				// les deux athlètes avec perf
				else {
					var compute = computeEcarts(sel1.perf, sel2.perf);
					laTable.row.add({e : listeEpreuves[i], nom1 : sel1.nom, perf1 :  sel1.perf, nom2 : sel2.nom,  perf2 : sel2.perf, ecart : compute}).draw();
				}
			}
			drawChart();
		}
	};
	xmlhttp.open("GET", "getRecordsClub.php?q=" + p_nom, true);
	xmlhttp.send();
}

function chargeJsonAthlete(p_nom, numAthlete){
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
		 if (this.readyState == 4 && this.status == 200) {
			 var reponseGetRecords = this.responseText;
			 
			 var jsonData = JSON.parse(reponseGetRecords);

			 if (numAthlete == 1){
				recordsSel1 = jsonData;
			} else {
				recordsSel2 = jsonData;
			}

			 var laTable = $("#table_ecarts").DataTable();
			 
			 laTable.clear();
			 
			 for (var i = 0; i < listeEpreuves.length; i++) {

				var sel1 = getRecordOfEpreuve(listeEpreuves[i], recordsSel1);
				var sel2 = getRecordOfEpreuve(listeEpreuves[i], recordsSel2);

				if (sel1.length == 0 && sel2.length == 0){
					// rien, pas de record ni pour aucun des deux athlètes
				}
				// sel1 null, sel2 non null
				else if (sel1.length == 0){
					laTable.row.add({e : listeEpreuves[i], nom1 : '', perf1 :  '', nom2 : sel2.nom,  perf2 : sel2.perf, ecart : ''}).draw();
				}
				// sel1 non null, sel2 null
				else if (sel2.length == 0){
					laTable.row.add({e : listeEpreuves[i], nom1 : sel1.nom, perf1 :  sel1.perf, nom2 : '',  perf2 : '', ecart : ''}).draw();
				}
				// les deux athlètes avec perf
				else {
					var compute = computeEcarts(sel1.perf, sel2.perf);
					laTable.row.add({e : listeEpreuves[i], nom1 : sel1.nom, perf1 :  sel1.perf, nom2 : sel2.nom,  perf2 : sel2.perf, ecart : compute}).draw();
				}
			}
			drawChart();
		}
	};
	xmlhttp.open("GET", "getRecords.php?q=" + p_nom, true);
	xmlhttp.send();
}

function getRecordOfEpreuve(epreuve, recordsJson){

	for(var i = 0; i < recordsJson.record.length; i++){
		if(recordsJson.record[i].e == epreuve){
			var p = recordsJson.record[i].perf;
			if (p.charAt(0) == "0"){
				recordsJson.record[i].perf = p.substring(1);
			}
			return recordsJson.record[i];
		}
	}
	return '';
}

// idSpan : txtHint
function showHint(str, idSpan) {
    if (str.length < 3) { 
        document.getElementById(idSpan).innerHTML = "";
        return;
    } else {
    	var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var nom = this.responseText;
                document.getElementById(idSpan).innerHTML = nom;
            }
        };
        xmlhttp.open("GET", "getNom.php?q=" + str, true);
        xmlhttp.send();

    }
    
}
document.getElementById("statistiques").setAttribute("class", "active");

$('.alphaonly').bind('keyup blur', function() {
	var node = $(this);
	node.val(node.val().replace(/[^A-Za-z ]/g, ''));
});
</script>
</body>
</html>