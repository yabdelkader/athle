<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="css/bootstrap.min.css" media="screen, projection" rel="stylesheet" type="text/css" />
<!-- <link href="css/bootstrap-theme.css" media="screen, projection" rel="stylesheet" type="text/css" /> -->
<link href="css/dataTables.bootstrap.min.css" media="screen, projection" rel="stylesheet" type="text/css" />
<script src="js/jquery-1.12.3.js" type="text/javascript"></script>
<script src="js/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="js/dataTables.bootstrap.min.js"></script>
<script src="js/bootstrap.min.js" type="text/javascript"></script>
</head>

<body>
	<div class="content">

		<div class="col-sm-2"></div>
		<div class="col-sm-8">

			<div id="menu"></div>
			<h1>Ecarts de records en pourcentage</h1>

<div class="row">

<form name="formRecords">
	
	<div class="form-group  col-sm-5">
	<label>Records de la 1ère sélection</label>
	<select name="zone1" class="form-control">
		<option selected="selected">Monde</option>
		<option>Europe</option>
		<option>France</option>
		<option>Club</option>
		<option>Athlète</option>
	</select>
	<select name="sexe1" class="form-control">
		<option selected="selected">Femme</option>
		<option>Homme</option>
	</select>	
	<select name="categorie1" class="form-control">
		<option selected="selected">Toutes catégories</option>
		<option>Cadet</option>
		<option>Junior</option>
		<option>Plus de 40 ans</option>
	</select>
	</div>
	<div class="form-group col-sm-5">
	<label>Records de la 2nde sélection</label>
	<select id="zone2" name="zone2" class="form-control">
		<option selected="selected">Monde</option>
		<option>Europe</option>
		<option>France</option>
		<option>Club</option>
		<option>Athlète</option>
	</select>
	<select id="selectSexe2" name="sexe2" class="form-control">
		<option>Femme</option>
		<option selected="selected">Homme</option>
	</select>	
	<select id="selectCategorie2" name="categorie2" class="form-control">
		<option selected="selected">Toutes catégories</option>
		<option>Cadet</option>
		<option>Junior</option>
		<option>Plus de 40 ans</option>
	</select>

<!-- =========================== -->
		 <div id="divClub2" style="display:none">
			<label for="club2" class="col-sm-3 control-label">Club</label>
			 <div class="col-sm-5">
 	<input type="text" name="searchClub2" id="searchClub2" placeholder="saisissez le début du nom" list="listeClub2"
 	 autocomplete="off" required="required" style="width: 250px;"/>
	<datalist id="listeClub2"></datalist>	
			 </div>
			 </div>
			 
			 <br/><br/>

			 <div id="divAthlete2" style="display:none">

			 <label for="athlete2" class="col-sm-1 control-label">Athlète</label>

			 <div class="col-sm-2">
					<datalist id="listeAthlete2"></datalist>
			 </div>
			 <div class="col-sm-2">
		 		<input type="text" name="searchAthlete2" id="searchAthlete2" placeholder="saisissez le début du nom" list="listeAthlete2"
		 	 		autocomplete="off" required="required" style="width: 250px;"/>
		 	 		
		 	 		


		<div class="form-group">
			<label for="nom" class="col-sm-2 control-label">Nom</label>
			<div class="col-sm-4">
				<input type="search" class="alphaonly form-control" name="nom" placeholder="nom"
				 onkeyup="showHint(this.value, 'txtHint')"								
			 size="20" maxlength="20" required="required">
			</div>
			<div class="col-sm-4"><span id="txtHint"></span></div>

		</div>

		 	 		
		 	 		
		 	 		
		 	 </div>
		 	 <div class="col-sm-1"><button class="btn btn-primary btn-sm" onclick="chargeAthlete();">OK</button></div>

			 </div> 
		</div>

<!-- =========================== -->			 
</form>	
</div> <!-- END row -->
<br/>


	<table class="table table-striped table-bordered" id="table_ecarts"></table>

		</div>
	</div>

	<script src="js/menu.js" type="text/javascript"></script>
	
	


<script type="text/javascript">

function selection(){
	
    $("#table_ecarts tbody").children().remove();
    
    // var jsonData = JSON.parse(reponseGetLicence);
    // for (var i = 0; i < jsonData.clubs.length; i++) {
	var zone1 = document.formRecords.zone1.selectedIndex;
	var zone2 = document.formRecords.zone2.selectedIndex;
	var categorie1 = document.formRecords.categorie1.selectedIndex;
	var categorie2 = document.formRecords.categorie2.selectedIndex;
	var sexe1 = document.formRecords.sexe1.selectedIndex;
	var sexe2 = document.formRecords.sexe2.selectedIndex;
	
	console.log(zone1 + ' ' + categorie1 + ' ' + sexe1 + ' ' + zone2 + ' ' + categorie2 + ' ' + sexe2);

	$("#divClub2").css({'display' : 'none'});	
	$("#divAthlete2").css({'display' : 'none'});
	$("#selectCategorie2").css({'display' : ''});
	$("#selectSexe2").css({'display' : ''});
	
	// club on montre input club et on laisse sexe - catégorie
	if(zone2 == 3){
		$("#divClub2").css({'display' : ''});	
	}
	// athlete on montre inuput athle et on masque sexe - categorie
	else if(zone2 == 4){
		$("#divAthlete2").css({'display' : ''});
		$("#selectCategorie2").css({'display' : 'none'});
		$("#selectSexe2").css({'display' : 'none'});
	}
    
    // ---- SELECTION 1 ----
    var recordsSel1;
	// zone monde 0, europe 1, france 2
    if (zone1 == 0 && categorie1 == 0 && sexe1 == 1){		recordsSel1 = recordsMondeHomme;}
	else if (zone1 == 0 && categorie1 == 0 && sexe1 == 0){	recordsSel1 = recordsMondeFemme;}
	else if (zone1 == 0 && categorie1 == 2 && sexe1 == 1){	recordsSel1 = recordsMondeHommeJunior;}
	else if (zone1 == 0 && categorie1 == 2 && sexe1 == 0){	recordsSel1 = recordsMondeFemmeJunior;}
	// zone europe 1
	// TODO
	// zone france 2
	else if (zone1 == 2 && categorie1 == 0 && sexe1 == 1){	recordsSel1 = recordsFranceHomme;}
	else if (zone1 == 2 && categorie1 == 0 && sexe1 == 0){	recordsSel1 = recordsFranceFemme;}
	else if (zone1 == 2 && categorie1 == 2 && sexe1 == 1){	recordsSel1 = recordsFranceHommeJunior;}
	else if (zone1 == 2 && categorie1 == 2 && sexe1 == 0){	recordsSel1 = recordsFranceFemmeJunior;}    
	// zone autre
	else {console.log('sélection autre non dispo actuellement'); return;}

    // ---- SELECTION 2 ----
    var recordsSel2;
    if (zone2 == 0 && categorie2 == 0 && sexe2 == 0){		recordsSel2 = recordsMondeFemme;}
	else if (zone2 == 0 && categorie2 == 0 && sexe2 == 1){	recordsSel2 = recordsMondeHomme;} 
	// zone europe 1
	// TODO
	// zone france 2
	else if (zone2 == 2 && categorie2 == 0 && sexe2 == 0){	recordsSel2 = recordsFranceFemme;}
	else if (zone2 == 2 && categorie2 == 0 && sexe2 == 1){	recordsSel2 = recordsFranceHomme;}
	// zone autre
	else {console.log('sélection autre non dispo actuellement'); return;}

	     	
    
    var laTable = $("#table_ecarts").DataTable();
    
    laTable.clear();
    
    for (var i = 0; i < recordsSel1.record.length; i++) {
    	var sel1 = recordsSel1.record[i];
    	var sel2 = recordsSel2.record[i];

    	// add en HTML à supprimer
    	//$("#table_ecarts tbody").append('<tr><td>' + sel1.epreuve + '</td>' 			+ '<td>' + sel1.nom + '</td><td>' + sel1.perf + '</td>' 			+ '<td>' + sel2.nom + '</td><td>' + sel2.perf + '</td><td></td></tr>');	

    	// add en objet plus propre
    	// $("#table_ecarts").dataTable().add(['111','ssss','ssss','ssss','ssss']);
    	// laTable.row.add(['111','ssss','ssss','ssss','ssss']);

    	var compute = computeEcarts(sel1.perf, sel2.perf);
    	laTable.row.add({epreuve : sel1.epreuve, nom1 : sel1.nom, perf1 :  sel1.perf, nom2 : sel2.nom,  perf2 : sel2.perf, ecart : compute}).draw();
 	}	
}

function createTableHead(){
	
	var records = { data : [
	
	]}
	
	var table = $('#table_ecarts').DataTable({
		data : records.data,
	  columns : [
	    { data: 'epreuve', title: 'Epreuve' },
	    { data: 'nom1', title: 'Nom' },
	    { data: 'perf1', title: 'Performance' },    
	    { data: 'nom2', title: 'Nom' },
	    { data: 'perf2', title: 'Performance' },    
	    { data: 'ecart', title: 'Pourcentage' },
      ]  
	});
	
	selection();
}

function computeEcarts(p1, p2){
	
	var c1 = getCentiemes(p1);
    var c2 = getCentiemes(p2);
    
    if ((p1.indexOf("m", 0) > -1)){
    	return calculEcartCentiemes(c2, c1);
    }
    return calculEcartCentiemes(c1, c2);
}

function getCentiemes(temps) {

	var heures;
	var minutes;
	var secondes;
	var centiemes;

	// '9.58'.indexOf(".", 0)  >> 1;
	// '19.58'.indexOf(".", 0)  >> 2;
	// '9.58'.indexOf(".", 3) >> -1
	// '9.55'.substring(0, 1, 9.55) >> 9;

	// -----------------
	// cas particulier temps sup à 1h
	if (temps.indexOf("h", 0) > -1){
		heures = temps.substring(0, 1);
		minutes = temps.substring(2, 4);
		secondes = temps.substring(3, 5); 
		centiemes = 0;
		
		var i_heures = parseInt(heures);
	    var i_minutes = parseInt(minutes);
		var i_secondes = parseInt(secondes);

	    i_minutes = (i_heures * 60) + i_minutes; 	    
		return ((i_minutes * 60) + i_secondes) * 100;		
	}
	// -----------------
	// cas particulier distance 8m95
	if (temps.indexOf("m", 0) > -1){
		var metres = parseInt(temps.substring(0, 1));
		var centimetres = parseInt(temps.substring(2, 4));
		return (metres * 100) + centimetres;		
	}	
	// -----------------
	// chrono 9.58
	if (temps.length == 4){
		minutes = 0;
		secondes = temps.substring(0, 1);
		centiemes = temps.substring(2, 4);
	}
	// -----------------
	// chrono 10.49, 19.19
	else if (temps.length == 5){
		minutes = 0;
		secondes = temps.substring(0, 2);
		centiemes = temps.substring(3, 5);
	}
	// -----------------
	// chrono 1.53.29
	else if (temps.length == 7){
		minutes = temps.substring(0, 1);
		secondes = temps.substring(2, 4);
		centiemes = temps.substring(5, 7);
	}
	// -----------------
	// chrono 12.58.98
	else if (temps.length == 8){
		minutes = temps.substring(0, 2);
		secondes = temps.substring(3, 5);
		centiemes = temps.substring(6, 8);
	}

    var i_minutes = parseInt(minutes);
	var i_secondes = parseInt(secondes);
	var i_centiemes = parseInt(centiemes);

	return (i_minutes * 60 * 100) + (i_secondes * 100) + i_centiemes;
}

function calculEcartCentiemes(c1, c2) {
    // console.log('calculEcartCentiemes(' + c1 + ',' + c2 + ')');
	return Math.round((c2 / c1) * 10000) / 100; 
    
};

</script>

<script type="text/javascript" class="init">

$('.dropdown-toggle').dropdown();

var recordsMondeHomme =
{'record' : [
{epreuve : '100', nom : 'Bolt',        perf :  '9.58'}, 
{epreuve : '200', nom : 'Bolt',        perf : '19.19'},
{epreuve : '400', nom : 'Van den Nierk', perf : '43.03'},
{epreuve : '800', nom : 'Rudisha', perf : '1.40.91'},
{epreuve : '1500', nom : 'El Geurrouj', perf : '3.26.00'},
{epreuve : '3000', nom : 'Komen', perf : '7.20.67'},
{epreuve : '5000', nom : 'Bekele', perf : '12.37.35'},
{epreuve : '10000', nom : 'Bekele', perf : '26.17.53'},
{epreuve : 'Marathon', nom : 'Kipchoge', perf : '2h00.25'},
{epreuve : 'Longueur', nom : 'Powell', perf : '8m95'}
]
};

var recordsMondeHommeJunior =
{'record' : [
{epreuve : '100', nom : 'Brommel',        perf :  '9.97'}, 
{epreuve : '200', nom : 'Bolt',        perf : '19.93'},
{epreuve : '400', nom : 'Lewis', perf : '43.87'},
{epreuve : '800', nom : 'Amos', perf : '1.41.73'},
{epreuve : '1500', nom : 'Kwemoi', perf : '3.28.81'},
{epreuve : '3000', nom : 'Kejelcha', perf : '7.28.19'},
{epreuve : '5000', nom : 'Gebrhiwet', perf : '12.47.53'},
{epreuve : '10000', nom : 'Wanjiru', perf : '26.41.75'},
{epreuve : 'Marathon', nom : 'Kipchoge', perf : ''},
{epreuve : 'Longueur', nom : 'xxxx', perf : '8m20'}
]
};
	
var recordsMondeFemme =
{'record' : [
{epreuve : '100', nom : 'Joyner', perf :  '10.48'}, 
{epreuve : '200', nom : 'Joyner', perf : '21.34'},
{epreuve : '400', nom : 'Koch', perf : '47.60'},
{epreuve : '800', nom : 'Kratochilova', perf : '1.53.28'},
{epreuve : '1500', nom : 'Dibaba G.', perf : '3.50.07'},
{epreuve : '3000', nom : 'Junxia', perf : '8.06.11'},
{epreuve : '5000', nom : 'Dibaba T.', perf : '14.11.15'},
{epreuve : '10000', nom : 'Ayana', perf : '29.17.45'},
{epreuve : 'Marathon', nom : 'Radclif', perf : '2h15.25'},
{epreuve : 'Longueur', nom : 'Joyner', perf : '7m52'}
]
};

var recordsMondeFemmeJunior =
{'record' : [
{epreuve : '100', nom : 'xxx', perf :  ''}, 
{epreuve : '200', nom : 'xxx', perf : ''},
{epreuve : '400', nom : 'xxx', perf : ''},
{epreuve : '800', nom : 'xxx', perf : ''},
{epreuve : '1500', nom : 'xxx', perf : ''},
{epreuve : '3000', nom : 'xxx', perf : ''},
{epreuve : '5000', nom : 'xxx', perf : ''},
{epreuve : '10000', nom : 'xxx', perf : ''},
{epreuve : 'Marathon', nom : 'xxx', perf : ''},
{epreuve : 'Longueur', nom : 'xxxx', perf : '7m20'}
]
};

var recordsFranceHomme =
{'record' : [
{epreuve : '100', nom : 'Vicaud',        perf :  '9.86'}, 
{epreuve : '200', nom : 'Lemaitre',        perf : '19.80'},
{epreuve : '400', nom : 'Djhone', perf : '44.46'},
{epreuve : '800', nom : 'Boss', perf : '1.42.53'},
{epreuve : '1500', nom : 'Baala', perf : '3.28.98'},
{epreuve : '3000', nom : 'Essaid', perf : '7.30.78'},
{epreuve : '5000', nom : 'Sghir', perf : '12.58.83'},
{epreuve : '10000', nom : 'Martins', perf : '27.22.78'},
{epreuve : 'Marathon', nom : 'Zwierchewski', perf : '2h06.35'},
{epreuve : 'Longueur', nom : 'Klouchi', perf : '8m42'}
]
};

var recordsFranceHommeJunior =
{'record' : [
{epreuve : '100', nom : 'xxx', perf :  ''}, 
{epreuve : '200', nom : 'xxx', perf : ''},
{epreuve : '400', nom : 'xxx', perf : ''},
{epreuve : '800', nom : 'xxx', perf : ''},
{epreuve : '1500', nom : 'xxx', perf : ''},
{epreuve : '3000', nom : 'xxx', perf : ''},
{epreuve : '5000', nom : 'xxx', perf : ''},
{epreuve : '10000', nom : 'xxx', perf : ''},
{epreuve : 'Marathon', nom : 'xxx', perf : ''},
{epreuve : 'Longueur', nom : 'xxxx', perf : '8m20'}
]
};
    
var recordsFranceFemme =
{'record' : [
{epreuve : '100', nom : 'Arron',  perf :  '10.73'}, 
{epreuve : '200', nom : 'Pérec', perf : '21.99'},
{epreuve : '400', nom : 'Pérec', perf : '48.25'},
{epreuve : '800', nom : 'Djaté', perf : '1.56.53'},
{epreuve : '1500', nom : 'Dehiba', perf : '3.59.76'},
{epreuve : '3000', nom : 'Ghezielle', perf : '8.35.41'},
{epreuve : '5000', nom : 'Maury', perf : '14.43.90'},
{epreuve : '10000', nom : 'Daunay', perf : '31.35.81'},
{epreuve : 'Marathon', nom : 'Daunay', perf : '2h25.00'},
{epreuve : 'Longueur', nom : 'Barber', perf : '7m05'}
]
};

var recordsFranceFemmeJunior =
{'record' : [
{epreuve : '100', nom : 'xxx', perf :  ''}, 
{epreuve : '200', nom : 'xxx', perf : ''},
{epreuve : '400', nom : 'xxx', perf : ''},
{epreuve : '800', nom : 'xxx', perf : ''},
{epreuve : '1500', nom : 'xxx', perf : ''},
{epreuve : '3000', nom : 'xxx', perf : ''},
{epreuve : '5000', nom : 'xxx', perf : ''},
{epreuve : '10000', nom : 'xxx', perf : ''},
{epreuve : 'Marathon', nom : 'xxx', perf : ''},
{epreuve : 'Longueur', nom : 'xxxx', perf : '6m80'}
]
};


createTableHead();
		
		
	//	$("select").change(
	//		function(){
//				console.log("uhuhuhu");		
//			}
//		);
	var elts = document.querySelectorAll("select");
	for (var i = 0; i < elts.length; i++){
		elts[i].addEventListener("change", selection, true);
	}

		$("#searchClub2").on("input", function(e) {
			var val = $(this).val();
			if(val === ""){
				return;
			}

			$.get("getClub.php", {q:val}, function(listeClubs) {

				var dataList = $("#listeClub2");
				dataList.empty();
				
				for (var i = 0; i < listeClubs.clubs.length; i++) {
				    var obj = listeClubs.clubs[i];
				    console.log(obj.c);
					var opt = $("<option></option>").attr("value", obj.c);
					dataList.append(opt);
				}
			},"json");
		});

		$("#searchAthlete2").on("input", function(e) {
			var val = $(this).val();
			if(val === ""){
				return;
			}

			$.get("getAthlete.php", {q:val}, function(listeClubs) {

				var dataList = $("#listeAthlete2");
				dataList.empty();
				
				for (var i = 0; i < listeAthletes.athletes.length; i++) {
				    var obj = listeClubs.clubs[i];
				    console.log(obj.c);
					var opt = $("<option></option>").attr("value", obj.c);
					dataList.append(opt);
				}
			},"json");
		});

		
		function chargeAthlete(){
			alert('chargeAthlete');
		}
		
// idSpan : txtHint
function showHint(str, idSpan) {
    if (str.length < 3) { 
        document.getElementById(idSpan).innerHTML = "";
        return;
    } else {
    	var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var nom = this.responseText;
                document.getElementById(idSpan).innerHTML = nom;
            }
        };
        xmlhttp.open("GET", "getNom.php?q=" + str, true);
        xmlhttp.send();

    }
    
}
		
</script>
<script>document.getElementById("statistiques").setAttribute("class", "active");</script>
	
	
</body>
</html>