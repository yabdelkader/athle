<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
<link href="css/bootstrap.min.css" media="screen, projection" rel="stylesheet" type="text/css" />
<link href="css/dataTables.bootstrap.min.css" media="screen, projection" rel="stylesheet" type="text/css" />

<script src="js/jquery-1.12.3.js" type="text/javascript"></script>
<script src="js/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="js/dataTables.bootstrap.min.js"></script>
<script src="js/bootstrap.min.js" type="text/javascript"></script>

<script src="js/recordsMonde.js" type="text/javascript"></script>
<script src="js/recordsCuba.js" type="text/javascript"></script>
<script src="js/recordsFrance.js" type="text/javascript"></script>
</head>

<body>
	<div class="content">

		<div class="col-sm-2"></div>
		<div class="col-sm-8">

			<div id="menu"></div>
			<h1>Comparaisons de records - écarts en pourcentage</h1>

<div class="row">

	<!-- div selection1 -->
	<div class="form-group col-sm-5">
	
	<label>Records de la 1ère sélection</label>
	<select id="selectZone1" class="form-control">
		<option value="1"  selected="selected">Monde</option>
		<option value="2">Pays</option>
		<option value="3">Club</option>
		<option value="4">Athlète</option>

	</select>
	<select id="selectPays1" class="form-control">

<optgroup label="Afrique">
	<option value="3">Afrique du Sud</option>
	<option value="4">Algérie</option>
	<option value="69">Botswana</option>
	<option value="71">Burundi</option>
	<option value="72">Cameroun</option>
	<option value="27">Côte d''Ivoire</option>
	<option value="1">Égypte</option>
	<option value="22">Éthiopie</option>
	<option value="77">Gabon</option>
	<option value="78">Ghana</option>
	<option value="81">Kenya</option>
	<option value="84">Mali</option>
	<option value="85">Maroc</option>
	<option value="87">Nigeria</option>
	<option value="18">Ouganda</option>
	<option value="93">Sénégal</option>
	<option value="94">Soudan</option>
	<option value="62">Zambie</option>
	<option value="97">Zimbabwe</option>
</optgroup>

<optgroup label="Amérique">
	<option value="6">Antigua-et-Barbuda</option>
	<option value="8">Argentine</option>
	<option value="65">Bahamas</option>
	<option value="70">Brésil</option>
	<option value="39">la Barbade</option>
	<option value="73">Canada</option>
	<option value="74">Chili</option>
	<option value="75">Costa Rica</option>
	<option value="30">Colombie</option>
	<option value="33">Cuba</option>
	<option value="2">Équateur</option>
	<option value="64">États-Unis</option>
	<option value="36">Grenade</option>
	<option value="38">Jamaïque</option>
	<option value="86">Mexique</option>
	<option value="88">Panama</option>
	<option value="89">Paraguay</option>
	<option value="21">Uruguay</option>
	
	
</optgroup>


<optgroup label="Asie">
	<option value="31">Corée du Sud</option>
	<option value="28">Chine</option>
	<option value="13">Inde</option>
	<option value="95">Sri Lanka</option>
</optgroup>


<optgroup label="Europe">
	<option value="5">Allemagne</option>
	<option value="10">Autriche</option>
	<option value="24">Belgique</option>
	<option value="25">Biélorussie</option>
	<option value="26">Bulgarie</option>
	<option value="29">Chypre</option>
	<option value="32">Croatie</option>
	<option disabled="disabled">Catalogne (soon)</option>
	<option value="76">Danemark</option>
	<option value="11">Espagne</option>
	<option value="12">Estonie</option>
	<option value="34">Finlande</option>
	<option value="1789" selected="selected">France</option>
	<option value="35">Grèce</option>
	<option value="37">Hongrie</option>
	<option value="17">Italie</option>
	<option value="15">Irlande</option>
	<option value="40">Lettonie</option>
	<option value="41">Lituanie</option>
	<option value="83">Luxembourg</option>
	<option value="90">Portugal</option>
	<option value="92">Royaume-Uni</option>
	<option value="67">Pays-Bas</option>
	<option value="52">Russie</option>
	<option value="53">Serbie</option>
	<option value="54">Slovénie</option>
	<option value="55">Slovaquie</option>
	<option value="56">Suède</option>
	<option value="57">Suisse</option>
	<option value="20">Ukraine</option>

	
</optgroup>

<optgroup label="Océanie">

	<option value="7">Arabie saoudite</option>
	<option value="9">Australie</option>
	<option value="23">Bahreïn</option>
	<option value="63">États fédérés de Micronésie</option>
	<option value="14">Iran</option>
	<option value="16">Israël</option>
	<option value="19">Ouzbékistan</option>

	<option value="42">Maurice</option>
	<option value="43">Namibie</option>
	<option value="44">Norvège</option>
	<option value="45">Nouvelle-Zélande</option>
	<option value="46">Pologne</option>
	<option value="47">Porto Rico</option>
	<option value="48">République démocratique du Congo</option>
	<option value="49">République dominicaine</option>
	<option value="50">République tchèque</option>
	<option value="51">Roumanie</option>
	<option value="58">Taïwan</option>
	<option value="59">Thaïlande</option>
	<option value="60">Trinité-et-Tobago</option>
	<option value="61">Turquie</option>
	<option value="66">Bermudes</option>
	<option value="68">Seychelles</option>
	<option value="79">Japon</option>
	<option value="80">Kazakhstan</option>
	<option value="82">Kirghizistan</option>

	<option value="91">Qatar</option>

	<option value="96">Venezuela</option>

	
		
</optgroup>

		
	</select>	
	<select id="selectSexe1" class="form-control">
		<option>Femme</option>
		<option selected="selected">Homme</option>
	</select>	
	<select id="selectCategorie1" class="form-control">
		<option selected="selected">Toutes catégories</option>
		<option>Cadet</option>
		<option>Junior</option>
		<option >35</option>
		<option>40</option>
		<option>45</option>
		<option>50</option>
		<option>55</option>
		<option>60</option>
		<option>65</option>
		<option>70</option>
		<option>75</option>
		<option>80</option>
	</select>
			 
	<br/><br/>

	<div id="divClub1" style="display:none">
		<label for="club1" class="col-sm-3 control-label">Club</label>
		<div class="col-sm-3">
		 	<input type="text" name="searchClub1" id="searchClub1" placeholder="saisissez le début du nom ou sélectionnez" list="listeClub1"
		 	 autocomplete="off" style="width: 250px;"/>
			<datalist id="listeClub1">
			<option value="Ac Paris-joinville" selected="selected" />
			<option value="Us Creteil"/>
			</datalist>
			<button class="btn btn-primary btn-sm" onclick="chargeClub1();">OK</button>
		</div>
		<div class="clearfix"></div>
		<div class="alert alert-info" role="alert">
		Les records des clubs ne sont proposés que pour 400, 800 et 3000 d'après la base athle.fr.
		Pour les clubs <b>Ac Paris-joinville</b> et <b>Us Creteil</b> les records sont extraits des sites de ces derniers.  
		</div>
		 
	</div>
			 
	<br/><br/>

	<div id="divAthlete1" style="display:none">
		<label for="textNom1" class="col-sm-2 control-label">Nom</label>
		<div class="col-sm-5">
			<input type="text" class="alphaonly form-control" id="textNom1" name="textNom1" placeholder="nom" onkeyup="showHint(this.value, 'txtHint1')" size="20" maxlength="20" />
		</div>
		<div class="col-sm-5"><span id="txtHint1"></span></div>		
		
		<br/><br/>

		<label for="prenom1" class="col-sm-2 control-label">Prénom</label>
		
		<div class="col-sm-5">
			<input type="search" class="alphaonly form-control" name="prenom1" placeholder="prénom" size="20" maxlength="20" />
		</div>
		<div class="col-sm-5"><span id="txtHint1Prenom"></span></div>
		<div class="col-sm-1"><button class="btn btn-primary btn-sm" onclick="chargeAthlete1();">OK</button></div>
	</div>
	</div> <!-- end selection 1 -->

	<!-- selection 2 -->
	<div class="form-group col-sm-5">
	<label>Records de la 2nde sélection</label>
	<select id="selectZone2" class="form-control">
		<option value="1" selected="selected">Monde</option>
		<option value="2">Pays</option>
		<option value="3">Club</option>
		<option value="4">Athlète</option>
	</select>
	<select id="selectPays2" class="form-control">

<optgroup label="Afrique">
	<option value="3">Afrique du Sud</option>
	<option value="4">Algérie</option>
	<option value="69">Botswana</option>
	<option value="71">Burundi</option>
	<option value="72">Cameroun</option>
	<option value="27">Côte d''Ivoire</option>
	<option value="1">Égypte</option>
	<option value="22">Éthiopie</option>
	<option value="77">Gabon</option>
	<option value="78">Ghana</option>
	<option value="81">Kenya</option>
	<option value="84">Mali</option>
	<option value="85">Maroc</option>
	<option value="87">Nigeria</option>
	<option value="18">Ouganda</option>
	<option value="93">Sénégal</option>
	<option value="94">Soudan</option>
	<option value="62">Zambie</option>
	<option value="97">Zimbabwe</option>
	
	
	
</optgroup>

<optgroup label="Amérique">
	<option value="6">Antigua-et-Barbuda</option>
	<option value="8">Argentine</option>
	<option value="65">Bahamas</option>
	<option value="70">Brésil</option>
	<option value="39">la Barbade</option>
	<option value="73">Canada</option>
	<option value="74">Chili</option>
	<option value="75">Costa Rica</option>
	<option value="30">Colombie</option>
	<option value="33">Cuba</option>
	<option value="2">Équateur</option>
	<option value="64">États-Unis</option>
	<option value="36">Grenade</option>
	<option value="38">Jamaïque</option>
	<option value="86">Mexique</option>
	<option value="88">Panama</option>
	<option value="89">Paraguay</option>
	<option value="21">Uruguay</option>
	
	
</optgroup>


<optgroup label="Asie">
	<option value="31">Corée du Sud</option>
	<option value="28">Chine</option>
	<option value="13">Inde</option>
	<option value="95">Sri Lanka</option>
</optgroup>


<optgroup label="Europe">
	<option value="5">Allemagne</option>
	<option value="10">Autriche</option>
	<option value="24">Belgique</option>
	<option value="25">Biélorussie</option>
	<option value="26">Bulgarie</option>
	<option value="29">Chypre</option>
	<option value="32">Croatie</option>
	<option disabled="disabled">Catalogne (soon)</option>
	<option value="76">Danemark</option>
	<option value="11">Espagne</option>
	<option value="12">Estonie</option>
	<option value="34">Finlande</option>
	<option value="1789" selected="selected">France</option>
	<option value="35">Grèce</option>
	<option value="37">Hongrie</option>
	<option value="17">Italie</option>
	<option value="15">Irlande</option>
	<option value="40">Lettonie</option>
	<option value="41">Lituanie</option>
	<option value="83">Luxembourg</option>
	<option value="90">Portugal</option>
	<option value="92">Royaume-Uni</option>
	<option value="67">Pays-Bas</option>
	<option value="52">Russie</option>
	<option value="53">Serbie</option>
	<option value="54">Slovénie</option>
	<option value="55">Slovaquie</option>
	<option value="56">Suède</option>
	<option value="57">Suisse</option>
	<option value="20">Ukraine</option>

	
</optgroup>

<optgroup label="Océanie">

	<option value="7">Arabie saoudite</option>
	<option value="9">Australie</option>
	<option value="23">Bahreïn</option>
	<option value="63">États fédérés de Micronésie</option>
	<option value="14">Iran</option>
	<option value="16">Israël</option>
	<option value="19">Ouzbékistan</option>

	<option value="42">Maurice</option>
	<option value="43">Namibie</option>
	<option value="44">Norvège</option>
	<option value="45">Nouvelle-Zélande</option>
	<option value="46">Pologne</option>
	<option value="47">Porto Rico</option>
	<option value="48">République démocratique du Congo</option>
	<option value="49">République dominicaine</option>
	<option value="50">République tchèque</option>
	<option value="51">Roumanie</option>
	<option value="58">Taïwan</option>
	<option value="59">Thaïlande</option>
	<option value="60">Trinité-et-Tobago</option>
	<option value="61">Turquie</option>
	<option value="66">Bermudes</option>
	<option value="68">Seychelles</option>
	<option value="79">Japon</option>
	<option value="80">Kazakhstan</option>
	<option value="82">Kirghizistan</option>

	<option value="91">Qatar</option>

	<option value="96">Venezuela</option>
	</optgroup>


	</select>	
	<select id="selectSexe2" class="form-control">
		<option >Femme</option>
		<option selected="selected">Homme</option>
	</select>	
	<select id="selectCategorie2" class="form-control">
		<option selected="selected">Toutes catégories</option>
		<option>Cadet</option>
		<option>Junior</option>
		<option>35</option>
		<option>40</option>
		<option>45</option>
		<option>50</option>
		<option>55</option>
		<option>60</option>
		<option>65</option>
		<option>70</option>
		<option>75</option>
		<option>80</option>
	</select>

			 
	<br/><br/>
	<div id="divClub2" style="display:none">
		<label for="club2" class="col-sm-3 control-label">Club</label>
		<div class="col-sm-3">
		 	<input type="text" name="searchClub2" id="searchClub2" placeholder="saisissez le début du nom ou sélectionnez" list="listeClub2"
		 	 autocomplete="off" style="width: 250px;"/>
			<datalist id="listeClub2">
			<option value="Ac Paris-joinville"  />
			<option value="Us Creteil" selected="selected"/>
			</datalist>
			<button class="btn btn-primary btn-sm" onclick="chargeClub2();">OK</button>
		</div>
		<div class="clearfix"></div>
		<div class="alert alert-info" role="alert">
		Les records des clubs ne sont proposés que pour 400, 800 et 3000 d'après la base athle.fr.
		Pour les clubs <b>Ac Paris-joinville</b> et <b>Us Creteil</b> les records sont extraits des sites de ces derniers.  
		</div>		
	</div>
			 
	<br/><br/>

	<div id="divAthlete2"> <!--  style="display:none"> -->
		 	 		
		<label for="textNom2" class="col-sm-2 control-label">Nom</label>
		<div class="col-sm-5">
			<input type="text" class="alphaonly form-control" id="textNom2" name="textNom2" placeholder="nom" onkeyup="showHint(this.value, 'txtHint2')"
		 size="20" maxlength="20" />
		</div>
		<div class="col-sm-5"><span id="txtHint2"></span></div>		
				
		<br/><br/>
	
		<label for="prenom2" class="col-sm-2 control-label">Prénom</label>
		<div class="col-sm-5">
			<input type="search" class="alphaonly form-control" name="prenom2" placeholder="prénom" size="20" maxlength="20" />
		</div>
		<div class="col-sm-5"><span id="txtHint2Prenom"></span></div> 		
		<div class="col-sm-1"><button class="btn btn-primary btn-sm" onclick="chargeAthlete2();">OK</button></div>
		</div> 
	</div>
<!--  </form>  -->
</div> <!-- END row -->
<br/>

		<div class="row">
		<div class="col-sm-4">
		<button id="btnShowHide" class="btn btn-primary">Masquer / montrer graphique</button>
		</div>
       <div class="col-sm-3" style="margin-top:7px;">
       	<a href="https://goo.gl/EX2C4J" style="font-size: 9px">Documentation de la page</a>
       </div>
		</div> 
       <div id="chart_div" style="width: 900px; height: 500px;"></div>

<script type="text/javascript" src="charts/google/jsapi?autoload={'modules':[{'name':'visualization','version':'1','packages':['corechart']}]}"></script>
<script type="text/javascript">
var button = document.getElementById('btnShowHide'); // Assumes element with id='button'

button.onclick = function() {
    var div = document.getElementById('chart_div');
    if (div.style.display !== 'none') {
        div.style.display = 'none';
    }
    else {
        div.style.display = 'block';
    }
};

google.setOnLoadCallback(drawChart);
function drawChart() {
	var tableCalculee = [];
                     
	tableCalculee.push(['Epreuve', libelleSel1, libelleSel2]);
     
	for (var i = 0; i < listeEpreuves.length; i++) {

		var sel1 = getRecordOfEpreuve(listeEpreuves[i], recordsSel1);
		var sel2 = getRecordOfEpreuve(listeEpreuves[i], recordsSel2);

		var ecart = computeEcarts(sel1.perf, sel2.perf);
		
		if (ecart.length === 0){
			// rien pour éviter pics du graph
		}
		else {
			tableCalculee.push([listeEpreuves[i], 100, ecart]);
		}
	}

	var data = google.visualization.arrayToDataTable(tableCalculee);

	var options = {
		title: 'Comparatif'
   };

	var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

	chart.draw(data, options);
}
   </script>

	<table class="table table-striped table-bordered" id="table_ecarts"></table>

		</div>
	</div>

	<script src="js/menu.js" type="text/javascript"></script>
	
	


<script type="text/javascript">
function selection1(){
	recordsSel1 = selectionNum(1);
}

function selection2(){
	recordsSel2 = selectionNum(2);
}


function selection(){

	var laTable = $("#table_ecarts").DataTable();

	laTable.clear();
	
	for (var i = 0; i < listeEpreuves.length; i++) {

		var sel1 = getRecordOfEpreuve(listeEpreuves[i], recordsSel1);
		var sel2 = getRecordOfEpreuve(listeEpreuves[i], recordsSel2);

		if (sel1.length == 0 && sel2.length == 0){
			// rien, pas de record ni pour aucun des deux athlètes
		}
		// sel1 null, sel2 non null
		else if (sel1.length == 0){
			laTable.row.add({e : listeEpreuves[i], nom1 : '', perf1 :  '', nom2 : sel2.nom,  perf2 : sel2.perf, ecart : ''}).draw();
		}
		// sel1 non null, sel2 null
		else if (sel2.length == 0){
			laTable.row.add({e : listeEpreuves[i], nom1 : sel1.nom, perf1 :  sel1.perf, nom2 : '',  perf2 : '', ecart : ''}).draw();
		}
		// les deux athlètes avec perf
		else {
			var compute = computeEcarts(sel1.perf, sel2.perf);
			laTable.row.add({e : listeEpreuves[i], nom1 : sel1.nom, perf1 :  sel1.perf, nom2 : sel2.nom,  perf2 : sel2.perf, ecart : compute}).draw();
		}
	}
	drawChart();
}

// on ne met à jour que la var globale recordsSel1
function selectionNum(num){
	
    $("#table_ecarts tbody").children().remove();
    
    var zone      = document.getElementById("selectZone"      + num).selectedIndex;
	var categorie = document.getElementById("selectCategorie" + num).selectedIndex;
	var sexe      = document.getElementById("selectSexe"      + num).selectedIndex;
	var pays      = document.getElementById("selectPays"      + num).value;

	console.log('zone ' + zone + ' ' + ', pays ' +  pays + ', categorie ' + categorie + ', sexe ' + sexe);
	
	if (num == 1){
    	libelleSel1 = getLibelle(zone, pays, sexe, categorie);
		console.log('libelleSel1 ' + libelleSel1);
	}
	else {
	    libelleSel2 = getLibelle(zone, pays, sexe, categorie);
	}
	
	
	// =============
	// Par défaut on masque les select pays et div "Club" et "Athlete" 

	// Si selection "Pays" alors on montre input pays et on laisse sexe et catégorie
	if (zone == 0){
		$("#selectCategorie" + num).css({'display' : ''});
		$("#selectSexe"      + num).css({'display' : ''});
		$("#selectPays"      + num).css({'display' : 'none'});
		$("#divClub"         + num).css({'display' : 'none'});	
		$("#divAthlete"      + num).css({'display' : 'none'});
		
	}
	if(zone == 1){
		$("#selectPays"      + num).css({'display' : ''});
		$("#selectSexe"      + num).css({'display' : ''});
		$("#selectCategorie" + num).css({'display' : 'none'});		
		$("#divClub"         + num).css({'display' : 'none'});	
		$("#divAthlete"      + num).css({'display' : 'none'});
	}
	// Si selection "Club" alors on montre input club et on laisse sexe - catégorie
	if(zone == 2){
		$("#divClub"    + num).css({'display' : ''});	
		$("#selectSexe" + num).css({'display' : ''});
		$("#divAthlete"      + num).css({'display' : 'none'});		
		$("#selectPays" + num).css({'display' : 'block'});
	}
	// Si selection "Athlete" alors on montre inuput athle et on masque sexe - categorie
	else if(zone == 3){
		$("#divAthlete"      + num).css({'display' : ''});
		$("#selectCategorie" + num).css({'display' : 'none'});
		$("#selectSexe"      + num).css({'display' : 'none'});
		$("#divClub"         + num).css({'display' : 'none'});		
	}

	// zone monde 0
	// -------- categorie all
    if (zone == 0) {
    	
	// ---- sexe femme  
		if (sexe == 0){
			
			if (categorie == 0){	return recordsMondeFemme;}
			if (categorie == 1){	return recordsMondeFemmeCadet;}
			if (categorie == 2){	return recordsMondeFemmeJunior;}
			if (categorie == 3){	return recordsMondeFemme35;}
			if (categorie == 4){	return recordsMondeFemme40;}
			if (categorie == 5){	return recordsMondeFemme45;}
			if (categorie == 6){	return recordsMondeFemme50;}
			if (categorie == 7){	return recordsMondeFemme55;}
			if (categorie == 8){	return recordsMondeFemme60;}
			if (categorie == 9){	return recordsMondeFemme65;}
			if (categorie == 10){	return recordsMondeFemme70;}
			if (categorie == 11){	return recordsMondeFemme75;}
			if (categorie == 12){	return recordsMondeFemme80;}
		}
		// ---- sexe homme 
		else {
			if (categorie == 0){	return recordsMondeHomme;}
			if (categorie == 1){	return recordsMondeHommeCadet;}
			if (categorie == 2){	return recordsMondeHommeJunior;}
			if (categorie == 3){	return recordsMondeHomme35;}
			if (categorie == 4){	return recordsMondeHomme40;}
			if (categorie == 5){	return recordsMondeHomme45;}
			if (categorie == 6){	return recordsMondeHomme50;}
			if (categorie == 7){	return recordsMondeHomme55;}
			if (categorie == 8){	return recordsMondeHomme60;}
			if (categorie == 9){	return recordsMondeHomme65;}
			if (categorie == 10){	return recordsMondeHomme70;}
			if (categorie == 11){	return recordsMondeHomme75;}
			if (categorie == 12){	return recordsMondeHomme80;}
		}
	} // end monde
	// ===============================
	// zone pays 1
	else if (zone == 1){
		// Tous pays sauf France 
		if (pays != 1789){
			$("#selectCategorie" + num).css({'display' : 'none'});
			chargeJsonRecordsPays(num, pays, sexe);
			
			if (num == 1){
				return	recordsSel1;
			} else {
				return recordsSel2;
			}
			
		}
		// France
		else if (pays == 1789){
		
			// ---- sexe femme  
			return recordsFranceHomme;
		}
	}
}



function getLibelle(zone, pays, sexe, categorie){
	
	var str = "";
	
	if (zone === 0){
		str = 'Records monde';
	}
	else if (zone === 1){
		str = 'Records pays';
	}
	// athlete 
	else if (zone === 3){
		return 'Records '; // + athlete;
	}

	if (sexe === 0){
		str = str + " femme";
	}
	else {
		str = str + " homme";
	}
	// club
	if (zone === 2){
		return str;
	}

	
	
	if (categorie === 0){
		return str;
	}
	else if (categorie === 1){ 	str = str + " cadets"; 	}
	else if (categorie === 2){ 	str = str + " junior"; 	}
	else if (categorie === 3){ 	str = str + " master 35"; 	}
	else if (categorie === 4){ 	str = str + " master 40"; 	}
	else if (categorie === 5){ 	str = str + " master 45"; 	}
	else if (categorie === 6){ 	str = str + " master 50"; 	}
	else if (categorie === 7){ 	str = str + " master 55"; 	}

	
	return str;
}

function getRecordEpreuve(epr, tabRecords){
	for (var i = 0; i < tabRecords.length; i++) {
		// console.info('test si = ' + tabRecords[i].e);
		if (tabRecords[i].e == epr){
			return tabRecords[i];
		}
	}
	return '0';
}

function createTableHead(){
	
	var records = { data : [
	
	]};
	
	var table = $('#table_ecarts').DataTable({
		data : records.data,
        "paging": false, 
        "info": false,         
	  columns : [
	    { data: 'e', title: 'Epreuve' },
	    { data: 'nom1', title: 'Nom' },
	    { data: 'perf1', title: 'Performance' },    
	    { data: 'nom2', title: 'Nom' },
	    { data: 'perf2', title: 'Performance' },    
	    { data: 'ecart', title: 'Pourcentage' },
      ]  
	});
	recordsSel1 = selectionNum(1);
	recordsSel2 = selectionNum(2);

	selection();
}

function computeEcarts(p1, p2){
	
	if (p1 == null || p2 == null){
		return "";
	}
	
	var c1 = getCentiemes(p1);
    var c2 = getCentiemes(p2);
    
    if ((p1.indexOf("m", 0) > -1)){
    	return calculEcartCentiemes(c2, c1);
    }
    return calculEcartCentiemes(c1, c2);
}

function getCentiemes(temps) {

	if (temps == null){
		return 0;
	}

	var heures;
	var minutes;
	var secondes;
	var centiemes;

	// '9.58'.indexOf(".", 0)  >> 1;
	// 51.1
	// '19.58'.indexOf(".", 0)  >> 2;
	// '9.58'.indexOf(".", 3) >> -1
	// '9.55'.substring(0, 1, 9.55) >> 9;

	// -----------------
	// cas particulier temps sup à 1h
	if (temps.indexOf("h", 0) > -1){
		heures = temps.substring(0, 1);
		minutes = temps.substring(2, 4);
		secondes = temps.substring(3, 5); 
		centiemes = 0;
		
		var i_heures = parseInt(heures);
	    var i_minutes = parseInt(minutes);
		var i_secondes = parseInt(secondes);

	    i_minutes = (i_heures * 60) + i_minutes; 	    
		return ((i_minutes * 60) + i_secondes) * 100;		
	}
	// -----------------
	// cas particulier distance 8m95 ou 17m92
	if (temps.indexOf("m", 0) > -1){
		if (temps.length == 4){ // longueur
			var metres = parseInt(temps.substring(0, 1));
			var centimetres = parseInt(temps.substring(2, 4));
			return (metres * 100) + centimetres;
		}
		// triple ou lancers
			var metres = parseInt(temps.substring(0, 2));
			var centimetres = parseInt(temps.substring(3, 5));
			return (metres * 100) + centimetres;
	}	
	// -----------------
	// chrono 9.58 ou 51.1
	if (temps.length == 4){
		minutes = 0;
		// 9.58
		if (temps.indexOf(".") == 1){
			secondes = temps.substring(0, 1);
			centiemes = temps.substring(2, 4);
		}
		// manuel 51.1
		else {
			secondes = temps.substring(0, 2);
			centiemes = temps.substring(3, 4) + '0';
		}
	}
	// -----------------
	// chrono 10.49, 19.19
	else if (temps.length == 5){
		minutes = 0;
		secondes = temps.substring(0, 2);
		centiemes = temps.substring(3, 5);
	}
	// -----------------
	// chrono 1.58.9
	else if (temps.length == 6){
		minutes = temps.substring(0, 1);
		secondes = temps.substring(2, 4);
		centiemes = temps.substring(5, 6) + '0';
	}	
	// -----------------
	// chrono 1.53.29 ou 14.23.5
	else if (temps.length == 7){
		
		// 1.53.29 : 5 car = "." 
		if (temps.charAt(4) == '.'){
			minutes = temps.substring(0, 1);
			secondes = temps.substring(2, 4);
			centiemes = temps.substring(5, 7);
		}
		// 14.23.5
		else {
			minutes = temps.substring(0, 2);
			secondes = temps.substring(3, 5);
			centiemes = temps.substring(6, 7);
		}
	}
	// -----------------
	// chrono 14.23.5
	else if (temps.length == 7){
		minutes = temps.substring(0, 2);
		secondes = temps.substring(3, 5);
		centiemes = temps.substring(6, 7) + '0';
	}

	// -----------------
	// chrono 12.58.98
	else if (temps.length == 8){
		minutes = temps.substring(0, 2);
		secondes = temps.substring(3, 5);
		centiemes = temps.substring(6, 8);
	}

    var i_minutes = parseInt(minutes);
	var i_secondes = parseInt(secondes);
	var i_centiemes = parseInt(centiemes);

	return (i_minutes * 60 * 100) + (i_secondes * 100) + i_centiemes;
}

function calculEcartCentiemes(c1, c2) {
    // console.log('calculEcartCentiemes(' + c1 + ',' + c2 + ')');
	return Math.round((c2 / c1) * 10000) / 100; 
    
};

</script>

<script type="text/javascript" class="init">

$('.dropdown-toggle').dropdown();

$("#selectCategorie" + 1).css({'display' : ''});
$("#selectSexe"      + 1).css({'display' : ''});
$("#selectPays"      + 1).css({'display' : 'none'});
$("#divClub"         + 1).css({'display' : 'none'});	
$("#divAthlete"      + 1).css({'display' : 'none'});

$("#selectCategorie" + 2).css({'display' : ''});
$("#selectSexe"      + 2).css({'display' : ''});
$("#selectPays"      + 2).css({'display' : 'none'});
$("#divClub"         + 2).css({'display' : 'none'});	
$("#divAthlete"      + 2).css({'display' : 'none'});


var recordsSel1 = {'record' : []};
var recordsSel2 = {'record' : []};

var libelleSel1 = 'sel1 init';
var libelleSel2 = 'sel2 init';


var listeEpreuves = ['100', '200', '400', '800', '1500', '3000', '5000', '10000', 'Marathon', '400 Haies', 'Steeple', 'Longueur', 'Triple saut'];

createTableHead();

var elts = document.querySelectorAll("select");
for (var i = 0; i < elts.length; i++){
	
	if ((elts[i].id.indexOf("1", 0) > -1)){
		elts[i].addEventListener("change", selection1, true);
	}
	else {
		elts[i].addEventListener("change", selection2, true);
	}
	
}

$("#searchClub2").on("input", function(e) {
	var val = $(this).val();
	if(val === ""){
		return;
	}

	$.get("getClub.php", {q:val}, function(listeClubs) {

		var dataList = $("#listeClub2");
		dataList.empty();
		
		for (var i = 0; i < listeClubs.clubs.length; i++) {
			var obj = listeClubs.clubs[i];
			console.log(obj.c);
			var opt = $("<option></option>").attr("value", obj.c);
			dataList.append(opt);
		}
	},"json");
});

function chargeClub1(){
	chargeJsonClub($("#searchClub1")[0].value, 1, document.getElementById("selectSexe1").selectedIndex);
}
function chargeClub2(){
	chargeJsonClub($("#searchClub2")[0].value, 2, document.getElementById("selectSexe2").selectedIndex);
}

function chargeAthlete1(){
	chargeJsonAthlete($("#textNom1")[0].value, 1);
}
function chargeAthlete2(){
	chargeJsonAthlete($("#textNom2")[0].value, 2);
}

function chargeJsonRecordsPays(numSelection, p_id_pays, p_sexe){
	
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
		 if (this.readyState == 4 && this.status == 200) {
			 var reponseGetRecords = this.responseText;
			 
			 var jsonData = JSON.parse(reponseGetRecords);

			 if (numSelection == 1){
				recordsSel1 = jsonData;
			} else {
				recordsSel2 = jsonData;
			}
			selection();
		}
	};
	if (p_sexe == 0){p_sexe = 1;}
	if (p_sexe == 1){p_sexe = 0;}
	xmlhttp.open("GET", "getRecordsPays.php?id_pays=" + p_id_pays + "&sexe=" + p_sexe, true);
	xmlhttp.send();
	
}

function chargeJsonClub(p_nom, num){
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
		 if (this.readyState == 4 && this.status == 200) {
			 var reponseGetRecords = this.responseText;
			 
			 var jsonData = JSON.parse(reponseGetRecords);

			 if (num == 1){
				recordsSel1 = jsonData;
			} else {
				recordsSel2 = jsonData;
			}
		}
	};
	if (p_sexe == 0){p_sexe = 1;}
	if (p_sexe == 1){p_sexe = 0;}
	xmlhttp.open("GET", "getRecordsClub.php?nom_club=" + p_nom + "&sexe=" + p_sexe, true);
	xmlhttp.send();
}

function chargeJsonAthlete(p_nom, numAthlete){
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
		 if (this.readyState == 4 && this.status == 200) {
			 var reponseGetRecords = this.responseText;
			 
			 var jsonData = JSON.parse(reponseGetRecords);

			 if (numAthlete == 1){
				recordsSel1 = jsonData;
			} else {
				recordsSel2 = jsonData;
			}
		}
	};
	xmlhttp.open("GET", "getRecords.php?q=" + p_nom, true);
	xmlhttp.send();
}

function getRecordOfEpreuve(epreuve, recordsJson){

	for(var i = 0; i < recordsJson.record.length; i++){
		if(recordsJson.record[i].e == epreuve){
			var p = recordsJson.record[i].perf;
			if (p.charAt(0) == "0"){
				recordsJson.record[i].perf = p.substring(1);
			}
			return recordsJson.record[i];
		}
	}
	return '';
}

// idSpan : txtHint
function showHint(str, idSpan) {
    if (str.length < 3) { 
        document.getElementById(idSpan).innerHTML = "";
        return;
    } else {
    	var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var nom = this.responseText;
                document.getElementById(idSpan).innerHTML = nom;
            }
        };
        xmlhttp.open("GET", "getNom.php?q=" + str, true);
        xmlhttp.send();

    }
    
}
document.getElementById("statistiques").setAttribute("class", "active");

$('.alphaonly').bind('keyup blur', function() {
	var node = $(this);
	node.val(node.val().replace(/[^A-Za-z ]/g, ''));
});
</script>
</body>
</html>