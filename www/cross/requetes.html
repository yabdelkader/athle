<!DOCTYPE html>
<html lang="fr">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Cross - requêtes</title>
	<link href="../css/bootstrap.min.css" media="screen, projection" rel="stylesheet" type="text/css" />

	<script src="js/jquery-3.3.1.js" type="text/javascript"></script>
	<script src="js/jquery.dataTables.min.js" type="text/javascript"></script>
	<script src="../js/bootstrap.min.js" type="text/javascript"></script>

<style type="text/css">
section > ul > li {
margin-top: 15px;
margin-bottom: 15px;
}

section > ul {
margin-left: -24px;
}

table {
 font-size: 0.8em;
}

th, td {
padding:5px;
border:solid 1px black;
}

pre {
 font-size: 12px;
}

.red {
background-color: #AAEEAA;
}
</style>

</head>
<body>
	<article>

		<div class="col-sm-2"></div>

		<div class="col-sm-8">


			<nav class="navbar" role="navigation" id="menu">
			<ul class="nav nav-pills">
				<li id="index"><a href="index.html">Accueil</a></li>
				<li id="athletes"><a href="recherche_athlete.html">Athl&egrave;tes</a></li>
				<li id="cross" role="presentation" class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Cross<span class="caret"></span></a>
					<ul class="dropdown-menu">
						<li><a href="resultats.html">Résultats</a></li>
					</ul>
				</li>
				<li id="statistiques" role="presentation" class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Bilans &amp; statistiques<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="../bilans.html">Bilans selon recherche multi-crit&egrave;res</a></li><li><a href="ages.html">Statistiques &acirc;ge</a></li><li id="international"><a href="international.html">Statistiques nationalités</a></li></ul></li>
				<li id="records" role="presentation" class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Records<span class="caret"></span></a><ul class="dropdown-menu"><li><li><a href="../records_pays_epreuve.html">Par &eacute;preuve</a></li><li><a href="rang_pays.html">Par pays</a></li><li><a href="import_records_wikipedia.html">Commentaires</a></li></ul></li>
				<li id="objectifs" role="presentation" class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Objectifs<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="../2018.html">2018</a></li><li><a href="../2019.html">2019</a></li><li><a href="../2020.html">2020</a></li></ul></li>
				<li id="a_propos" role="presentation"><a href="../a_propos.html">&Agrave; propos</a></li>
			</ul>
			
			</nav>
	</div>

	<div class="col-sm-offset-2 col-sm-8">

		<div class="alert alert-info">
			<div style="text-align: center;">
				<div style="font-weight: bold;font-size: 1.3em">Requêtes Cross 2010-2020</div>
	 		</div>
	 	<br/>
		<ul style="list-style-type: none;">
			<li><a href="#questions">1. Requêtes</a></li>
			<ul style="list-style-type: none;">
				<li><a href="#1.1">Plus médaillés</a></li>
				<li><a href="#1.2">Plus grand écart 1er et 2nd</a></li>
				<li><a href="#1.3">Plus grand nombre de particpations (athlètes)</a></li>
				<li><a href="#1.4">Plus grand nombre de particpations (clubs)</a></li>
				<li><a href="#1.6">Fidélité au club</a></li>
				<li><a href="#1.7">Âge moyen</a></li>
			</ul>
			
			<li><a href="#technique">2. Technique</a></li>
			<ul style="list-style-type: none;">
				<li><a href="#calcul_categorie">Calcul classement par categorie</a></li>
			</ul>			
			
		</ul>
	
		</div>
	
	</div>
	
	
	<section class="col-sm-offset-2 col-sm-8">

<h2 id="questions">1. Requêtes</h2>

<h3 id="1.1">Plus médaillés</h3>

/!\ cf. <a href="#calcul_categorie">Calcul classement </a> en amont pour recalculer les classements féminins à cause mélange senior / master / junior.
<br/><br/>

<pre><code class="language-sql">SELECT nom, count(*) AS nb_podium, GROUP_CONCAT(annee, ' ', rang SEPARATOR ', ') AS podium 
FROM cros WHERE championnat= 'dep' AND rang IN (1,2,3)
GROUP BY nom ORDER BY nb_podium DESC</code></pre>

<div class="row">
	<div class="col-md-4">
		Départementaux 94
		<table class="table table-striped table-bordered ">
			<tr style="background-color: #CCCCCC"><th>nom</th><th>nb_podium</th><th>podium</th></tr>
			<tr><td>BENNACER Mustapha (Alg)</td><td>2</td><td>2010 1, 2012 1</td></tr>
			<tr><td>DORGAN Florence</td><td>2</td><td>2012 1, 2010 3</td></tr>
		</table>
	</div>
	<div class="col-md-4">
		<div>Régionnaux Est</div>
		<table class="table table-striped table-bordered">
			<tr style="background-color: #CCCCCC"><th>nom</th><th>nb_podium</th><th>podium</th></tr>
<tr><td>BENNACER Mustapha (Alg)</td><td>2</td><td>2012 1, 2010 2</td></tr>
<tr><td>DJEMADI Abderrahmane (Alg)</td><td>2</td><td>2010 1, 2012 1</td></tr>
<tr><td>JACQUERAY Diony</td><td>2</td><td>2012 3, 2010 3</td></tr>
		</table>
	</div>
	<div class="col-md-4">
		<div>LIFA</div>
		<table class="table table-striped table-bordered">
			<tr style="background-color: #CCCCCC"><th>nom</th><th>nb_podium</th><th>podium</th></tr>
			<tr><td>DJEMADI Abderrahmane (Alg)</td><td>2</td><td>2010 1, 2012 1</td></tr>
			<tr><td>KHEZZANE Noreddine</td><td>2</td><td>2012 2, 2010 2</td></tr>
		</table>
	</div>

</div>

<h3 id="1.2">Plus grand écart 1er et 2nd</h3>

<pre><code class="language-sql"> SELECT c1.nom, c2.nom, c1.championnat, c1.annee, (SUBSTRING(c2.chrono, 1,2) * 60) + SUBSTRING(c2.chrono, 4) - (SUBSTRING(c1.chrono, 1,2) * 60) - SUBSTRING(c1.chrono, 4) AS ecart FROM cros c1
 JOIN cros c2 ON c2.rang = 2 AND c1.annee = c2.annee AND c1.championnat = c2.championnat AND c1.sexe = c2.sexe AND c1.id != c2.id AND c1.cat = c2.cat
 WHERE c1.rang = 1
 ORDER BY ecart DESC</code></pre>
 
<table class="table table-striped table-bordered">
<tr style="background-color: #CCCCCC"><th>nom</th><th>nom</th><th>championnat</th><th>annee</th><th>ecart</th></tr>
<tr><td>DORGAN Florence</td><td>ESPRIT Augustina</td><td>dep</td><td>2012</td><td>37</td></tr>
<tr><td>GILBERT Frederic</td><td>CHOUKRI Mohamed</td><td>dep</td><td>2012</td><td>37</td></tr>
<tr><td>GUERFI Riad</td><td>KENOUCHE Abdelslam</td><td>lifa</td><td>2012</td><td>28</td></tr>
<tr><td>KUMBI BECHERE Tura (Eth)</td><td>RAYNAUD Bertrand</td><td>reg</td><td>2020</td><td>27</td></tr>
<tr><td>BENNACER Mustapha (Alg)</td><td>BOUBEKEUR Achour</td><td>reg</td><td>2012</td><td>27</td></tr>
</table>


<h3 id="1.3">Plus grand nombre de particpations (athlètes)</h3>

 <pre><code class="language-sql">SELECT nom, count(*) AS participation FROM cros WHERE championnat = 'dep' GROUP BY nom  ORDER BY participation DESC</code></pre>

<div class="row">
	<div class="col-md-4">
		Départementaux 94
		<table class="table table-striped table-bordered"><tr style="background-color: #CCCCCC"><th>nom</th><th>participation</th></tr>
<tr><td>EL KADAOUI Samir</td><td>7</td></tr>
		</table>
	</div>

	<div class="col-md-4">
		<div>Régionnaux Est</div>
		<table class="table table-striped table-bordered"><tr style="background-color: #CCCCCC"><th>nom</th><th>participation</th></tr>

		</table>
	</div>

	<div class="col-md-4">
		LIFA
		<table class="table table-striped table-bordered"><tr style="background-color: #CCCCCC"><th>nom</th><th>participation</th></tr>

		</table>
	</div>
</div>

<h3 id="1.4">Plus grand nombre de particpations (clubs)</h3>

<pre><code class="language-sql">SELECT club, count(*) AS participation FROM cros WHERE championnat = 'dep' GROUP BY club  ORDER BY participation DESC</code></pre>
 
<div class="row">
	<div class="col-md-4">
		Départementaux 94
		<table class="table table-striped table-bordered"><tr style="background-color: #CCCCCC"><th>nom</th><th>participation</th></tr>
<tr><td>Ao Charenton</td><td>45</td></tr>
<tr><td>Asfi Villejuif</td><td>33</td></tr>
<tr><td>Ac Paris-joinville</td><td>32</td></tr>
<tr><td>Vincennes Athletic</td><td>31</td></tr>
		</table>
	</div>

	<div class="col-md-4">
		<div>Régionnaux Est</div>
		<table class="table table-striped table-bordered"><tr style="background-color: #CCCCCC"><th>nom</th><th>participation</th></tr>

		</table>
	</div>

	<div class="col-md-4">
		LIFA
		<table class="table table-striped table-bordered"><tr style="background-color: #CCCCCC"><th>nom</th><th>participation</th></tr>

		</table>
	</div>
</div>


<h3 id="1.6">Fidélité au club</h3>


<pre>SELECT nom, GROUP_CONCAT(distinct club, ' '), count(distinct club) AS nb_clubs FROM cros
GROUP BY nom
ORDER BY nb_clubs DESC;

SELECT nom, club, count(distinct club) AS nb_clubs, count(distinct annee) AS annees FROM cros
GROUP BY nom
ORDER BY nb_clubs ASC, annees DESC;
</pre>
<div class="row">
	<div class="col-md-6">
		Volages
		<table class="table table-striped table-bordered"><tr style="background-color: #CCCCCC"><th>nom</th><th>clubs</th><th>nombre</th></tr>
<tr><td>GINER Wilfried</td><td>Rambouillet Sports ,Paris Jean-bouin Casg ,Athle 78 * </td><td>3</td></tr>
<tr><td>GUEGANO Raphael</td><td>Ac Velizy-villacoublay ,Us Fontenay-sous-bois ,Stade De Vanves </td><td>3</td></tr>
</table>		</table>
	</div>

	<div class="col-md-6">
		<div>Fidèles</div>
		<table class="table table-striped table-bordered"><tr style="background-color: #CCCCCC"><th>nom</th><th>club</th><th>annnées</th></tr>

		</table>
	</div>

</div>


<h3 id="1.7">Âge moyen</h3>


<h2 id="technique">3. Technique &amp; difficultés</h2> 	
 	
<h3 id="calcul_categorie">Mélange de catégories</h3>

<p>Chez les hommes, hormis les quelques rares vétérans qui courent chez les séniors, les rangs sont les classement réels.</p>

<p>Chez les femmes c'est compliqué. Sénior et vétérannes courrent ensemble, même parfois même aussi avec les juniors hommes.</p>

<p>Par convention :</p>
<ul>
	<li>Pour calculer les classement vétérannes : il suffit d'éliminer les seniors ou junior. Pas de problème.</li>
	<li>En revanche, si une vétéranne fini devant une sénior elle compte. Autrement dit, on considère que la catégorie "senior" est "toute catégorie".
	<br/>
	Par exemple aux régionnaux 2014 : VERDURE Annie V1F fait 4ème. Juste derrière QUEMENER Anais et BALAGE Juliette font donc 5ème et 6ème, et non 4ème et 5ème.
	</li>
</ul>

<!-- 
<p>Calcul pour recalculer les classements</p>
<ol>
<li>DELETE FROM cros WHERE SUBSTRING(cat, 1, 1) = 'J'</li>
<li>on repère le premier et dernier id et on update rang.</li>
</ol>  

Attribuer le sexe :

<pre>UPDATE cros SET sexe = SUBSTRING(cat, 3, 3) WHERE SUBSTRING(cat, 3, 3) IN ('F','M')</pre> 
 
 -->
<h3>Index</h3>

CREATE  INDEX idx_annee  ON cros ( annee );

<h3>Nom long</h3>

<code>nom VARCHAR(32)</code> ne suffit pas toujours. <i>LARUELLE IMMERZEEL Nathalie (Ned)</i> 33 caractères.


<h2>Nommage</h2>

Vétéran devient Master en xxxx

Des vétérans courent chez les séniors.




<h2>SQL</h2>

<h3>Traitement des catégories</h3>

<pre>SELECT SUBSTRING(cat, 1,3) FROM cros;
SELECT SUBSTRING(cat, 5) FROM cros;</pre>


<h3>Divers</h3>

<pre>
UPDATE cros SET naissance = SUBSTRING(cat, 5) WHERE naissance = 99;
UPDATE cros SET naissance = (0 + SUBSTRING(cat, 5)) WHERE naissance = 99;
UPDATE cros SET cat = SUBSTRING(cat, 1, 3) WHERE LENGTH(cat) > 3;

UPDATE cros SET chrono = REPLACE(chrono, '_', '''');

SELECT  annee, cat, championnat, sexe, count(*) FROM cros group by annee, championnat, sexe, cat;



ALTER TABLE cros ADD CONSTRAINT unik UNIQUE    (annee,rang,championnat,sexe,cat);

SELECT * FROM cros c1 JOIN cros c2 ON c1.nom = c2.nom AND c1.sexe != c2.sexe;

UPDATE cros SET dep = SUBSTRING(dep, 2) WHERE LENGTH(dep) > 2



update cros set cat = SUBSTRING(cat, 1, 3)  where LENGTH(cat) > 3;

SELECT * FROM cros where annee = 2012 and rang = 35 and sexe = 'M' AND cat like 'V1M%';
update cros set cat = 'SVM/68' where id = 2055;
</pre>

</section>
<br/><br/>

</article>

<footer class="col-md-offset-3 col-md-6">
	<hr />
	<p style="text-align: center;">
		<i>Dernière MAJ <time pubdate="pubdate">22/02/2019</time></i>
	</p>
</footer>

	<script>document.getElementById("cross").setAttribute("class", "active");</script>
</body>
</html>