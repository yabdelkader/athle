<!DOCTYPE html>
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<html>
<head>
<meta charset="UTF-8" />
<title>Cross hommes</title>

	<link media="screen" rel="stylesheet" type="text/css" href="../css/bootstrap.min.css" />

 	<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.min.css"> 

<style type="text/css">
table{
  margin: 0 auto;
  width: 100%;
  clear: both;
  border-collapse: collapse;
  table-layout: fixed;
  word-wrap:break-word;
}
input {
	width:inherit;
}

th:first-child {
	width:50px 
}
th:nth-child(2){ width:80px }
th:nth-child(4){ width:150px }
th:nth-child(5){ width:70px }
th:nth-child(6){ width:70px }
th:nth-child(7){ width:70px }
th:nth-child(8){ width:50px }
th:nth-child(9){ width:30px }
</style>

	<script type="text/javascript" language="javascript" src="js/jquery-3.3.1.js"></script>
	<script type="text/javascript" language="javascript" src="js/jquery.dataTables.min.js"></script>
	

<!--
SELECT CONCAT('{"r":"', rang, '","chr":"', chrono, '","n":"', nom, '","cl":"', club, '", "d":"', dep, '", "cat":"', cat, '","nai":"', naissance, '", "ch":"' , championnat, '", "a":"', annee, '"},') FROM cros WHERE sexe = 'M';
 -->

	<script type="text/javascript" class="init">

	
	
var liste_cros = { data : [
{"r":"1","chr":"30'24","n":"NARDI COLOME Franck","cl":"Us Ivry", "d":"74", "cat":"M2M","nai":"0", "ch":"dep", "a":"2020"},
{"r":"2","chr":"30'31","n":"BEAUFORT Sebastien","cl":"Sporting Club Athletic De Bry-", "d":"75", "cat":"M2M","nai":"0", "ch":"dep", "a":"2020"},
{"r":"3","chr":"30'39","n":"DIANI Ilyas","cl":"Ac Paris-joinville", "d":"79", "cat":"M1M","nai":"0", "ch":"dep", "a":"2020"},
{"r":"4","chr":"31'20","n":"GRIBEAUVAL Ludovic","cl":"Ao Charenton", "d":"77", "cat":"M1M","nai":"0", "ch":"dep", "a":"2020"},
{"r":"5","chr":"31'28","n":"GRUNDTNER Willy","cl":"Ac Paris-joinville", "d":"79", "cat":"M1M","nai":"0", "ch":"dep", "a":"2020"},
{"r":"6","chr":"31'38","n":"ANDRIEU Olivier","cl":"Ac Paris-joinville", "d":"78", "cat":"M1M","nai":"0", "ch":"dep", "a":"2020"},
{"r":"7","chr":"32'04","n":"BENHADDA Feth-allah","cl":"Union Sportive Alfortville Ath", "d":"75", "cat":"M2M","nai":"0", "ch":"dep", "a":"2020"},
{"r":"8","chr":"32'16","n":"LEGER Franck","cl":"Sporting Club Athletic De Bry-", "d":"78", "cat":"M1M","nai":"0", "ch":"dep", "a":"2020"},
{"r":"9","chr":"32'19","n":"ABDELKADER Yann","cl":"Ac Paris-joinville", "d":"77", "cat":"M1M","nai":"0", "ch":"dep", "a":"2020"},
{"r":"10","chr":"32'22","n":"ROUHAUD Yvan","cl":"Ao Charenton", "d":"77", "cat":"M1M","nai":"0", "ch":"dep", "a":"2020"},
{"r":"11","chr":"32'29","n":"AUSTRUY Eric","cl":"Ao Charenton", "d":"80", "cat":"M1M","nai":"0", "ch":"dep", "a":"2020"},
{"r":"12","chr":"32'41","n":"EL KADAOUI Samir","cl":"Ac Paris-joinville", "d":"70", "cat":"M3M","nai":"0", "ch":"dep", "a":"2020"},
{"r":"13","chr":"32'47","n":"BLANCHARD Nicolas","cl":"Uai Nogent-sur-marne", "d":"77", "cat":"M1M","nai":"0", "ch":"dep", "a":"2020"}
]};
	

$(document).ready(function() {
	// Setup - add a text input to each footer cell
	$('#example thead tr').clone(true).appendTo( '#example thead' );
	$('#example thead tr:eq(1) th').each( function (i) {
		var title = $(this).text();
		$(this).html( '<input type="text"  />' );

		$( 'input', this ).on( 'keyup change', function () {
			if ( table.column(i).search() !== this.value ) {
				table
					.column(i)
					.search( this.value )
					.draw();
			}
		} );
	} );

	var table = $('#example').DataTable( {
		orderCellsTop: true,
		fixedHeader: false,
		data : liste_cros.data,
		"autoWidth": true,
		columns: [
			{ data: "r"},
			{ data: "chr"},
			{ data: "n"},
			{ data: "cl"},
			{ data: "d"},
			{ data: "cat" },
			{ data: "nai" },			
			{ data: "ch" },
			{ data: "a", width:"40px" }
		]
	} );
	
} );
	</script>
	
</head>
<body style="font-size: 1.1rem">


<article class="container">

	<div class="well"align="center">
		<h2>Cross hommes</h2>
	</div>

	<div class="row" style="margin:0px">
		<div class="col-md-12">
			<table id="example" class="display" style="width:100%">
				<thead>
					<tr>
					   	<th>Rang</th>
						<th>Chrono</th>
	 					<th>Nom</th>
	 					<th>Club</th>
	 					<th>Département</th>
	 					<th>Catégorie</th>
	 					<th>Naissance</th>
	 					<th>Dep Reg Lifa</th>
						<th>Annee</th> 					
					</tr>
				</thead>		
			</table>
			
			Sélection : [<span id="selected"></span>]<button class="button" id="btnDetail">Graph</button>&nbsp;<button class="button" id="btnReset">Reset</button><br/><br/><br/>
		</div>
	</div>
	<div class="row" style="margin:0px">
		<div class="col-md-6">
			<div id="linechart_materialDep" style="width: 900px; height: 500px;"></div>
		</div>
		<div class="col-md-6">
			<div id="linechart_materialReg" style="width: 900px; height: 500px;"></div>
		</div>
	</div>
</article>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

	<!--
	https://developers.google.com/chart/interactive/docs/gallery/linechart
	 -->
	<script type="text/javascript">
google.charts.load('current', {'packages':['line']});
// google.charts.setOnLoadCallback(drawDepInit);

$(document).ready(function() {
	  $("#btnDetail").on("click", function() {
	    drawDepRegLifa();
	  });
	  $("#btnReset").on("click", function() {
		$('#selected').text('');
	  });
});

function drawDepRegLifa() {
	
	var selection = $('#selected').text();
	if (selection.length == 0){
		alert("pas de sélection");
		return;
	}
	
	var tabSelection = selection.split(','); 
	var count = tabSelection.length - 1; 
	
	if (count == 0){
		drawDep1(tabSelection[0]);
		drawReg1(tabSelection[0]);
		return;
	}
	
	if (count == 1){
		drawDep2(tabSelection[0], tabSelection[1]);
		drawReg2(tabSelection[0], tabSelection[1]);
		return;
	}
	drawDep3(tabSelection[0], tabSelection[1], tabSelection[2]);
}

function drawDep1(nom) {	
	var data = new google.visualization.DataTable();
	data.addColumn('number', 'Annee');
	data.addColumn('number', nom);
	
	data.addRows([
	  [10,  37],
	  [18, 11]
	]);
	
	var options = {
		  chart: {
		    title: 'Départementaux',
		  },
		  width: 600,
		  height: 300,
		  legend: {position: 'top'}
	};
	var chart = new google.charts.Line(document.getElementById('linechart_materialDep'));
	chart.draw(data, google.charts.Line.convertOptions(options));
}

function drawReg1(nom) {	
	var data = new google.visualization.DataTable();
	data.addColumn('number', 'Annee');
	data.addColumn('number', nom);

	for(var i = 0; i < liste_cros.data.length; i++){
		if(liste_cros.data[i].n == nom){
			var r = parseInt(liste_cros.data[i].r);
			var annee = liste_cros.data[i].a  - 2000;
			console.log('data.addRow' + annee + ' ' +  r);
			data.addRow([annee,  r]);
		}
	}

	var options = {
		  chart: {
		    title: 'Régionnaux',
		  },
		  width: 500,
		  height: 300,
		  legend: {position: 'none'}
	};
	var chart = new google.charts.Line(document.getElementById('linechart_materialReg'));
	chart.draw(data, google.charts.Line.convertOptions(options));
}
function drawDep2(nom1, nom2) {
	alert("drawDep2");
}
function drawReg2(nom1, nom2) {
	// alert("drawDep2");
}
function drawDep3(nom1, nom2, nom3) {	
	var data = new google.visualization.DataTable();
	data.addColumn('number', 'Annee');
	data.addColumn('number', nom1);
	data.addColumn('number', nom2);
	data.addColumn('number', nom3);
	
	data.addRows([
	  [10,  37, 80, 41],
	  [12,  30, 69, 34],
	  [13,  25, 57, 25],
	  [14,  11, 18, 10],
	
	  [16,  8, , 17],
	  [17,  7, 12,  6],
	  [18, 12, 30, 11]
	]);
	
	var options = {
		  chart: {
		    title: 'Départementaux',
		  },
		  width: 600,
		  height: 300, 
		  legend: {position: 'bottom'}
	};
	var chart = new google.charts.Line(document.getElementById('linechart_materialDep'));
	chart.draw(data, google.charts.Line.convertOptions(options));
}

$(document).ready(function() {
	var table = $('#example').DataTable();
 
	$('#example tbody').on( 'click', 'tr', function () {
		$(this).toggleClass('selected');
	    var rowData = table.rows( { selected: true } ).data()[0];
	    var oldSelection = $('#selected').text(); 
	    var sel = $(this)[0].cells[2].innerHTML;
	    var newSel;
	    // si déjà sélectionné on retire
	    if (oldSelection.indexOf(sel) >= 0){
	    	newSel = oldSelection.replace(sel, '');
	    	$('#selected').text(newSel);
	    }
	    // sinon on ajout
	    else {
	    	if (oldSelection.length == 0){
	    		newSel = sel;
	    	}
	    	else {
	    		newSel = oldSelection + "," + sel;
	    	}
	    }
	    $('#selected').text(newSel);
	} );
 		
		
} );

</script>
</body>
</html>